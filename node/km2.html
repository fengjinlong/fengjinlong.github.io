<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>km2特性 | 个人博客</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/assets/css/0.styles.d9af7a00.css" as="style"><link rel="preload" href="/assets/js/app.6ba358d5.js" as="script"><link rel="preload" href="/assets/js/2.ae98e73b.js" as="script"><link rel="preload" href="/assets/js/38.dfa679d1.js" as="script"><link rel="prefetch" href="/assets/js/10.42ff595e.js"><link rel="prefetch" href="/assets/js/11.4ed22736.js"><link rel="prefetch" href="/assets/js/12.6a6a3966.js"><link rel="prefetch" href="/assets/js/13.2dc17c00.js"><link rel="prefetch" href="/assets/js/14.ecd84e84.js"><link rel="prefetch" href="/assets/js/15.8e63941b.js"><link rel="prefetch" href="/assets/js/16.20bbf036.js"><link rel="prefetch" href="/assets/js/17.cee65893.js"><link rel="prefetch" href="/assets/js/18.210997b6.js"><link rel="prefetch" href="/assets/js/19.6a9e1c28.js"><link rel="prefetch" href="/assets/js/20.58544cb3.js"><link rel="prefetch" href="/assets/js/21.13c2449f.js"><link rel="prefetch" href="/assets/js/22.b999c181.js"><link rel="prefetch" href="/assets/js/23.ba0e1341.js"><link rel="prefetch" href="/assets/js/24.4d053282.js"><link rel="prefetch" href="/assets/js/25.afea9c0f.js"><link rel="prefetch" href="/assets/js/26.eebee834.js"><link rel="prefetch" href="/assets/js/27.b5e919f8.js"><link rel="prefetch" href="/assets/js/28.eb2b8d47.js"><link rel="prefetch" href="/assets/js/29.39ddf55c.js"><link rel="prefetch" href="/assets/js/3.01798808.js"><link rel="prefetch" href="/assets/js/30.6d0c38c0.js"><link rel="prefetch" href="/assets/js/31.ae50bd7b.js"><link rel="prefetch" href="/assets/js/32.8f993527.js"><link rel="prefetch" href="/assets/js/33.e7076b44.js"><link rel="prefetch" href="/assets/js/34.02650f79.js"><link rel="prefetch" href="/assets/js/35.78660043.js"><link rel="prefetch" href="/assets/js/36.5720a95b.js"><link rel="prefetch" href="/assets/js/37.61ee918b.js"><link rel="prefetch" href="/assets/js/39.ed80ae84.js"><link rel="prefetch" href="/assets/js/4.086bf268.js"><link rel="prefetch" href="/assets/js/40.984dfb70.js"><link rel="prefetch" href="/assets/js/41.39b0efef.js"><link rel="prefetch" href="/assets/js/42.348c0630.js"><link rel="prefetch" href="/assets/js/43.af859649.js"><link rel="prefetch" href="/assets/js/44.231224a1.js"><link rel="prefetch" href="/assets/js/45.58ade8a2.js"><link rel="prefetch" href="/assets/js/46.87a325ea.js"><link rel="prefetch" href="/assets/js/47.639c4fd3.js"><link rel="prefetch" href="/assets/js/48.17b33593.js"><link rel="prefetch" href="/assets/js/49.f5dc4f70.js"><link rel="prefetch" href="/assets/js/5.33e71d3e.js"><link rel="prefetch" href="/assets/js/50.e91de543.js"><link rel="prefetch" href="/assets/js/51.8e808c23.js"><link rel="prefetch" href="/assets/js/52.210b18bf.js"><link rel="prefetch" href="/assets/js/53.51bb9c18.js"><link rel="prefetch" href="/assets/js/54.cc3b4480.js"><link rel="prefetch" href="/assets/js/55.d360f572.js"><link rel="prefetch" href="/assets/js/56.2a89706d.js"><link rel="prefetch" href="/assets/js/6.45b5ea40.js"><link rel="prefetch" href="/assets/js/7.227a1975.js"><link rel="prefetch" href="/assets/js/8.9cffc684.js"><link rel="prefetch" href="/assets/js/9.62b6f021.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d9af7a00.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">个人博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">vue</a></div><div class="nav-item"><a href="/" class="nav-link">css</a></div><div class="nav-item"><a href="/" class="nav-link">js</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">github</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/fengjinlong" target="_blank" rel="noopener noreferrer" class="nav-link external">
  1
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fengjinlong" target="_blank" rel="noopener noreferrer" class="nav-link external">
  2
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">vue</a></div><div class="nav-item"><a href="/" class="nav-link">css</a></div><div class="nav-item"><a href="/" class="nav-link">js</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">github</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/fengjinlong" target="_blank" rel="noopener noreferrer" class="nav-link external">
  1
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fengjinlong" target="_blank" rel="noopener noreferrer" class="nav-link external">
  2
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTML</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>http</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>docker</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>性能</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>yarn</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>php</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>node</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/node/1.html" class="sidebar-link">node基础</a></li><li><a href="/node/2.html" class="sidebar-link">node基础</a></li><li><a href="/node/km2.html" class="active sidebar-link">km2</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/node/km2.html#km2特性" class="sidebar-link">km2特性</a></li><li class="sidebar-sub-header"><a href="/node/km2.html#启动服务" class="sidebar-link">启动服务</a></li><li class="sidebar-sub-header"><a href="/node/km2.html#停止服务" class="sidebar-link">停止服务</a></li><li class="sidebar-sub-header"><a href="/node/km2.html#删除应用" class="sidebar-link">删除应用</a></li><li class="sidebar-sub-header"><a href="/node/km2.html#创建开机自启动" class="sidebar-link">创建开机自启动</a></li><li class="sidebar-sub-header"><a href="/node/km2.html#更新pm2" class="sidebar-link">更新PM2</a></li><li class="sidebar-sub-header"><a href="/node/km2.html#监听模式" class="sidebar-link">监听模式</a></li><li class="sidebar-sub-header"><a href="/node/km2.html#静态服务器" class="sidebar-link">静态服务器</a></li><li class="sidebar-sub-header"><a href="/node/km2.html#启用群集模式（自动负载均衡）" class="sidebar-link">启用群集模式（自动负载均衡）</a></li><li class="sidebar-sub-header"><a href="/node/km2.html#重新启动" class="sidebar-link">重新启动</a></li><li class="sidebar-sub-header"><a href="/node/km2.html#_0秒停机重新加载" class="sidebar-link">0秒停机重新加载</a></li><li class="sidebar-sub-header"><a href="/node/km2.html#查看启动列表" class="sidebar-link">查看启动列表</a></li><li class="sidebar-sub-header"><a href="/node/km2.html#查看每个应用程序占用情况" class="sidebar-link">查看每个应用程序占用情况</a></li><li class="sidebar-sub-header"><a href="/node/km2.html#显示应用程序所有信息" class="sidebar-link">显示应用程序所有信息</a></li><li class="sidebar-sub-header"><a href="/node/km2.html#日志查看" class="sidebar-link">日志查看</a></li><li class="sidebar-sub-header"><a href="/node/km2.html#保存当前应用列表" class="sidebar-link">保存当前应用列表</a></li><li class="sidebar-sub-header"><a href="/node/km2.html#重启保存的应用列表" class="sidebar-link">重启保存的应用列表</a></li><li class="sidebar-sub-header"><a href="/node/km2.html#清除保存的应用列表" class="sidebar-link">清除保存的应用列表</a></li><li class="sidebar-sub-header"><a href="/node/km2.html#保存并恢复pm2进程" class="sidebar-link">保存并恢复PM2进程</a></li><li class="sidebar-sub-header"><a href="/node/km2.html#pm2配置文件方式" class="sidebar-link">PM2配置文件方式</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>gulp</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>typescript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>webpack</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>mac</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>react</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>interview</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>functional</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>手写代码</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JSON</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>优化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>博文</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="km2特性"><a href="#km2特性" aria-hidden="true" class="header-anchor">#</a> km2特性</h2> <blockquote><ul><li>内建负载均衡（使用Node cluster 集群模块）</li> <li>后台运行</li> <li>0秒停机重载，我理解大概意思是维护升级的时候不需要停机.</li> <li>具有Ubuntu和CentOS 的启动脚本</li> <li>停止不稳定的进程（避免无限循环）</li> <li>控制台检测</li> <li>提供 HTTP API</li> <li>远程控制和实时的接口API ( Nodejs 模块,允许和PM2进程管理器交互 )</li></ul></blockquote> <h2 id="启动服务"><a href="#启动服务" aria-hidden="true" class="header-anchor">#</a> 启动服务</h2> <p>pm2 start app.js                //启动app.js应用
pm2 start app.js --name demo    //启动应用并设置name
pm2 start app.sh                //脚本启动</p> <h2 id="停止服务"><a href="#停止服务" aria-hidden="true" class="header-anchor">#</a> 停止服务</h2> <p>pm2 stop all               //停止所有应用
pm2 stop [AppName]        //根据应用名停止指定应用
pm2 stop [ID]             //根据应用id停止指定应用</p> <h2 id="删除应用"><a href="#删除应用" aria-hidden="true" class="header-anchor">#</a> 删除应用</h2> <p>pm2 delete all               //关闭并删除应用
pm2 delete [AppName]        //根据应用名关闭并删除应用
pm2 delete [ID]            //根据应用ID关闭并删除应用</p> <h2 id="创建开机自启动"><a href="#创建开机自启动" aria-hidden="true" class="header-anchor">#</a> 创建开机自启动</h2> <p>pm2 startup</p> <h2 id="更新pm2"><a href="#更新pm2" aria-hidden="true" class="header-anchor">#</a> 更新PM2</h2> <p>pm2 updatePM2
pm2 update</p> <h2 id="监听模式"><a href="#监听模式" aria-hidden="true" class="header-anchor">#</a> 监听模式</h2> <p>pm2 start app.js --watch    //当文件发生变化，自动重启</p> <h2 id="静态服务器"><a href="#静态服务器" aria-hidden="true" class="header-anchor">#</a> 静态服务器</h2> <p>pm2 serve ./dist 9090        //将目录dist作为静态服务器根目录，端口为9090</p> <h2 id="启用群集模式（自动负载均衡）"><a href="#启用群集模式（自动负载均衡）" aria-hidden="true" class="header-anchor">#</a> 启用群集模式（自动负载均衡）</h2> <p>//max 表示PM2将自动检测可用CPU的数量并运行尽可能多的进程
//max可以自定义，如果是4核CPU，设置为2者占用2个
pm2 start app.js -i max</p> <h2 id="重新启动"><a href="#重新启动" aria-hidden="true" class="header-anchor">#</a> 重新启动</h2> <p>pm2 restart app.js        //同时杀死并重启所有进程。短时间内服务不可用。生成环境推荐使用reload</p> <h2 id="_0秒停机重新加载"><a href="#_0秒停机重新加载" aria-hidden="true" class="header-anchor">#</a> 0秒停机重新加载</h2> <p>pm2 reload app.js        //重新启动所有进程，始终保持至少一个进程在运行
pm2 gracefulReload all   //优雅地以群集模式重新加载所有应用程序</p> <h2 id="查看启动列表"><a href="#查看启动列表" aria-hidden="true" class="header-anchor">#</a> 查看启动列表</h2> <p>pm2 list</p> <h2 id="查看每个应用程序占用情况"><a href="#查看每个应用程序占用情况" aria-hidden="true" class="header-anchor">#</a> 查看每个应用程序占用情况</h2> <p>pm2 monit</p> <h2 id="显示应用程序所有信息"><a href="#显示应用程序所有信息" aria-hidden="true" class="header-anchor">#</a> 显示应用程序所有信息</h2> <p>pm2 show [Name]      //根据name查看
pm2 show [ID]        //根据id查看</p> <h2 id="日志查看"><a href="#日志查看" aria-hidden="true" class="header-anchor">#</a> 日志查看</h2> <p>pm2 logs            //查看所有应用日志
pm2 logs [Name]    //根据指定应用名查看应用日志
pm2 logs [ID]      //根据指定应用ID查看应用日志</p> <h2 id="保存当前应用列表"><a href="#保存当前应用列表" aria-hidden="true" class="header-anchor">#</a> 保存当前应用列表</h2> <p>pm2 save</p> <h2 id="重启保存的应用列表"><a href="#重启保存的应用列表" aria-hidden="true" class="header-anchor">#</a> 重启保存的应用列表</h2> <p>pm2 resurrect</p> <h2 id="清除保存的应用列表"><a href="#清除保存的应用列表" aria-hidden="true" class="header-anchor">#</a> 清除保存的应用列表</h2> <p>pm2 cleardump</p> <h2 id="保存并恢复pm2进程"><a href="#保存并恢复pm2进程" aria-hidden="true" class="header-anchor">#</a> 保存并恢复PM2进程</h2> <p>pm2 update</p> <h2 id="pm2配置文件方式"><a href="#pm2配置文件方式" aria-hidden="true" class="header-anchor">#</a> PM2配置文件方式</h2> <p>生成示例配置文件
pm2 ecosystem        //生成一个示例JSON配置文件
pm2 init
配置文件示例（实际使用自行删除）</p> <div class="language- extra-class"><pre class="language-text"><code>module.exports = {
    apps : [{
        name      : 'API',      //应用名
        script    : 'app.js',   //应用文件位置
        env: {
            PM2_SERVE_PATH: &quot;.&quot;,    //静态服务路径
            PM2_SERVE_PORT: 8080,   //静态服务器访问端口
            NODE_ENV: 'development' //启动默认模式
        },
        env_production : {
            NODE_ENV: 'production'  //使用production模式 pm2 start ecosystem.config.js --env production
        },
        instances:&quot;max&quot;,          //将应用程序分布在所有CPU核心上,可以是整数或负数
        watch:true,               //监听模式
        output: './out.log',      //指定日志标准输出文件及位置
        error: './error.log',     //错误输出日志文件及位置，pm2 install pm2-logrotate进行日志文件拆分
        merge_logs: true,         //集群情况下，可以合并日志
        log_type:&quot;json&quot;,          //日志类型
        log_date_format: &quot;DD-MM-YYYY&quot;,  //日志日期记录格式
    }],
    deploy : {
        production : {
            user : 'node',                      //ssh 用户
            host : '212.83.163.1',              //ssh 地址
            ref  : 'origin/master',             //GIT远程/分支
            repo : 'git@github.com:repo.git',   //git地址
            path : '/var/www/production',       //服务器文件路径
            post-deploy : 'npm install &amp;&amp; pm2 reload ecosystem.config.js --env production'  //部署后的动作
        }
    }
};

</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">有志者，事竞成；苦心人，天不负: </span> <span class="time">9/5/2019, 9:47:03 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/node/2.html" class="prev">
          node基础
        </a></span> <span class="next"><a href="/gulp/1.html">
          初见
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.6ba358d5.js" defer></script><script src="/assets/js/2.ae98e73b.js" defer></script><script src="/assets/js/38.dfa679d1.js" defer></script>
  </body>
</html>
