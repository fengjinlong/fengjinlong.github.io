<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>仿函数式组件 | 个人博客</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/assets/css/0.styles.d9af7a00.css" as="style"><link rel="preload" href="/assets/js/app.6ba358d5.js" as="script"><link rel="preload" href="/assets/js/2.ae98e73b.js" as="script"><link rel="preload" href="/assets/js/54.cc3b4480.js" as="script"><link rel="prefetch" href="/assets/js/10.42ff595e.js"><link rel="prefetch" href="/assets/js/11.4ed22736.js"><link rel="prefetch" href="/assets/js/12.6a6a3966.js"><link rel="prefetch" href="/assets/js/13.2dc17c00.js"><link rel="prefetch" href="/assets/js/14.ecd84e84.js"><link rel="prefetch" href="/assets/js/15.8e63941b.js"><link rel="prefetch" href="/assets/js/16.20bbf036.js"><link rel="prefetch" href="/assets/js/17.cee65893.js"><link rel="prefetch" href="/assets/js/18.210997b6.js"><link rel="prefetch" href="/assets/js/19.6a9e1c28.js"><link rel="prefetch" href="/assets/js/20.58544cb3.js"><link rel="prefetch" href="/assets/js/21.13c2449f.js"><link rel="prefetch" href="/assets/js/22.b999c181.js"><link rel="prefetch" href="/assets/js/23.ba0e1341.js"><link rel="prefetch" href="/assets/js/24.4d053282.js"><link rel="prefetch" href="/assets/js/25.afea9c0f.js"><link rel="prefetch" href="/assets/js/26.eebee834.js"><link rel="prefetch" href="/assets/js/27.b5e919f8.js"><link rel="prefetch" href="/assets/js/28.eb2b8d47.js"><link rel="prefetch" href="/assets/js/29.39ddf55c.js"><link rel="prefetch" href="/assets/js/3.01798808.js"><link rel="prefetch" href="/assets/js/30.6d0c38c0.js"><link rel="prefetch" href="/assets/js/31.ae50bd7b.js"><link rel="prefetch" href="/assets/js/32.8f993527.js"><link rel="prefetch" href="/assets/js/33.e7076b44.js"><link rel="prefetch" href="/assets/js/34.02650f79.js"><link rel="prefetch" href="/assets/js/35.78660043.js"><link rel="prefetch" href="/assets/js/36.5720a95b.js"><link rel="prefetch" href="/assets/js/37.61ee918b.js"><link rel="prefetch" href="/assets/js/38.dfa679d1.js"><link rel="prefetch" href="/assets/js/39.ed80ae84.js"><link rel="prefetch" href="/assets/js/4.086bf268.js"><link rel="prefetch" href="/assets/js/40.984dfb70.js"><link rel="prefetch" href="/assets/js/41.39b0efef.js"><link rel="prefetch" href="/assets/js/42.348c0630.js"><link rel="prefetch" href="/assets/js/43.af859649.js"><link rel="prefetch" href="/assets/js/44.231224a1.js"><link rel="prefetch" href="/assets/js/45.58ade8a2.js"><link rel="prefetch" href="/assets/js/46.87a325ea.js"><link rel="prefetch" href="/assets/js/47.639c4fd3.js"><link rel="prefetch" href="/assets/js/48.17b33593.js"><link rel="prefetch" href="/assets/js/49.f5dc4f70.js"><link rel="prefetch" href="/assets/js/5.33e71d3e.js"><link rel="prefetch" href="/assets/js/50.e91de543.js"><link rel="prefetch" href="/assets/js/51.8e808c23.js"><link rel="prefetch" href="/assets/js/52.210b18bf.js"><link rel="prefetch" href="/assets/js/53.51bb9c18.js"><link rel="prefetch" href="/assets/js/55.d360f572.js"><link rel="prefetch" href="/assets/js/56.2a89706d.js"><link rel="prefetch" href="/assets/js/6.45b5ea40.js"><link rel="prefetch" href="/assets/js/7.227a1975.js"><link rel="prefetch" href="/assets/js/8.9cffc684.js"><link rel="prefetch" href="/assets/js/9.62b6f021.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d9af7a00.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">个人博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">vue</a></div><div class="nav-item"><a href="/" class="nav-link">css</a></div><div class="nav-item"><a href="/" class="nav-link">js</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">github</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/fengjinlong" target="_blank" rel="noopener noreferrer" class="nav-link external">
  1
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fengjinlong" target="_blank" rel="noopener noreferrer" class="nav-link external">
  2
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">vue</a></div><div class="nav-item"><a href="/" class="nav-link">css</a></div><div class="nav-item"><a href="/" class="nav-link">js</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">github</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/fengjinlong" target="_blank" rel="noopener noreferrer" class="nav-link external">
  1
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fengjinlong" target="_blank" rel="noopener noreferrer" class="nav-link external">
  2
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTML</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>http</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>docker</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>性能</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>yarn</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>php</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>node</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>gulp</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>typescript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>webpack</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>mac</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>react</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>interview</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>functional</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>手写代码</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/手写代码系列/1.html" class="active sidebar-link">手写代码</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/手写代码系列/1.html#仿函数式组件" class="sidebar-link">仿函数式组件</a></li><li class="sidebar-sub-header"><a href="/手写代码系列/1.html#简易版本" class="sidebar-link">简易版本</a></li><li class="sidebar-sub-header"><a href="/手写代码系列/1.html#三-instanceof" class="sidebar-link">三 instanceof</a></li><li class="sidebar-sub-header"><a href="/手写代码系列/1.html#四-new绑定" class="sidebar-link">四 new绑定</a></li><li class="sidebar-sub-header"><a href="/手写代码系列/1.html#四-请实现一个bind函数" class="sidebar-link">四 请实现一个bind函数</a></li><li class="sidebar-sub-header"><a href="/手写代码系列/1.html#五-请实现一个-json-stringify-和-json-parse" class="sidebar-link">五 请实现一个 JSON.stringify 和 JSON.parse ????????????????????</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JSON</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>优化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>博文</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="仿函数式组件"><a href="#仿函数式组件" aria-hidden="true" class="header-anchor">#</a> 仿函数式组件</h2> <div class="language- extra-class"><pre class="language-text"><code>目标： fun.f([1,2,3])  fun([1,2,3]).f() 效果相同

单个方法
var fun = function (obj) {
      console.log(this)
      // 返回对象
      if (!(this instanceof fun)) return new fun(obj);
      // 缓存参数
      this._wrapped = obj;
    }
    // 静态方法
    // fun.f([1,2,3])
    fun.f = function (arr) {
      console.log(arr.reverse())
    }
    // 将静态方法挂在原型上
    fun.mixin = function (obj) {
      var func = fun.f
      // 原型方法
      fun.prototype.f = function () {
        var ob = [this._wrapped];
        ob.push(arguments)
        func.apply(fun, ob)
      }
      return fun
    }
    // 调用后等到原型方法
    fun.mixin(fun)

    // 调用原型方法
    fun([1,2,3]).f(function (arr) {
      console.log(arr.reverse())
    })

    全部方法
    var fun = function (obj) {
      console.log(this)
      // 返回对象
      if (!(this instanceof fun)) return new fun(obj);
      // 缓存参数
      this._wrapped = obj;
    }
    fun.each = function (obj, callback) {
      if (Array.isArray(obj)) {
        for (const item of obj) {
          callback &amp;&amp; callback.call(_, item);
        }
      }
    }
    // 静态方法
    // fun.f([1,2,3])
    fun.f = function (arr) {
      console.log(arr.reverse())
    }
    // 将静态方法挂在原型上
    fun.mixin = function (obj) {
      //混合全部静态方法到原型链共享属性上
      fun.each(_.functions(obj), function (name) {
        var func = fun[name] = obj[name]
        fun.prototype[name] = function () {
          var args = [this._wrapped]
          args.push(arguments)
          func.apply(fun, args)
        }
      })
      return fun
    }
    // 调用后等到原型方法
    fun.mixin(fun)

    // 调用原型方法
    fun([1,2,3]).f()
</code></pre></div><h2 id="简易版本"><a href="#简易版本" aria-hidden="true" class="header-anchor">#</a> 简易版本</h2> <p>// 一 map
Array.prototype.myMap = function (callBack, content) {
var arr = this
var res = []
content = content ? content : window
for (let i = 0; i &lt; arr.length; i++) {
let ele = callBack.call(content, arr[i], i, arr)
res.push(ele)
}
return res
}</p> <p>// 二 reduce
Array.prototype.myReduce = function(callback) {
var arr = this;
var res; 
if(typeof(callback) !== &quot;function&quot;)  throw new Error(&quot;not a function&quot;);
if(arguments.length &lt; 2 &amp;&amp; arr.length === 0) throw new Error(&quot;empty array with no initial value&quot;);
if(arguments.length &lt; 2 &amp;&amp; arr.length === 1) return arr[0];
if(arguments.length &gt; 1 &amp;&amp; arr.length === 0) return arguments[1];
res = arguments.length &gt; 1? arguments[1] : arr.shift();
for(let i = 0; i &lt; arr.length; i++) {
res = callback(res, arr[i], i, arr);
}
return res;
}</p> <p>// map的reduce实现
Array.prototype._myMap = function(callback, context) {
context = context ? context : window;
return this.reduce((accum, item, index, arr) =&gt;
[...accum, callback.call(context, item, index, arr)]
, []);
}</p> <h2 id="三-instanceof"><a href="#三-instanceof" aria-hidden="true" class="header-anchor">#</a> 三 instanceof</h2> <div class="language- extra-class"><pre class="language-text"><code>/**
 * 判断left是不是right类型的对象
 * @param {*} left 
 * @param {*} right 
 * @return {Boolean}
 */
function instanceof2(left, right) {
    let prototype = right.prototype;
  
    // 沿着left的原型链, 看看是否有何prototype相等的节点
    left = left.__proto__;
    while(1) {
      if(left === null || left === undefined) {
        return false;
      }
      if(left === prototype) {
        return true;
      }
      left = left.__proto__;
    }
  }
  
  const selfInstanceof = function (left, right) {
    let proto = Object.getPrototypeOf(left)
    while (1) {
      if(left === null || left === undefined) {
        return false;
      }
      if (proto === right.prototype) {
        return true
      }
      proto = Object.getPrototyprOf(proto)
    }
  }
</code></pre></div><h2 id="四-new绑定"><a href="#四-new绑定" aria-hidden="true" class="header-anchor">#</a> 四 new绑定</h2> <div class="language- extra-class"><pre class="language-text"><code>// 1. 创建（或者说构造）一个新对象。
// 2. 这个新对象会被执行[[Prototype]]连接。
// 3. 这个新对象会绑定到函数调用的this。
// 4. 如果函数没有返回其他对象，那么new表达式中的函数调用会自动返回这个新对象。


// ### 手写一个new实现
function create () {
  // 创建一个新对象
  var obj = new Object()
  // 取出构造函数
  var Con = [].shift.call(arguments)
  // 新对象的原型指向构造函数
  // obj.__proto__ = Con.prototype
  // 由于性能问题，推荐使用
  Object.setPrototypeOf(obj, Con.prototype);
  // 绑定 this 实现继承，obj 可以访问到构造函数中的属性
  var o = Con.apply(obj, arguments)
  return o instanceof Object ? o : obj
}


function create() {
	// 1、获得构造函数，同时删除 arguments 中第一个参数
    Con = [].shift.call(arguments);
	// 2、创建一个空的对象并链接到原型，obj 可以访问构造函数原型中的属性
    var obj = Object.create(Con.prototype);
	// 3、绑定 this 实现继承，obj 可以访问到构造函数中的属性
    var ret = Con.apply(obj, arguments);
	// 4、优先返回构造函数返回的对象
	return ret instanceof Object ? ret : obj;
};

// ## 使用这个手写的new

function Person() {...}
// 使用内置函数new
var person = new Person(...)
// 使用手写的new，即create
var person = create(Person, ...)

// ## 代码原理解析：

// 1. 用new Object() 的方式新建了一个对象obj

// 2. 取出第一个参数，就是我们要传入的构造函数。此外因为 shift 会修改原数组，所以 arguments 会被去除第一个参数

// 3. 将 obj 的原型指向构造函数，这样obj就可以访问到构造函数原型中的属性

// 4. 使用 apply，改变构造函数 this 的指向到新建的对象，这样 obj 就可以访问到构造函数中的属性

// 5. 返回 obj

// ## new
const isComplexDataType = obj =&gt; (typeof obj === 'object || typeof obj === 'function') &amp;&amp; obj !== null
const selfNew = function (fn, ...rest) {
    let instance = Object.create(fn.prototype)
    let res = fn.apply(instance, rest)
    return isComplexDataType(res) ? res : instance
}
</code></pre></div><h2 id="四-请实现一个bind函数"><a href="#四-请实现一个bind函数" aria-hidden="true" class="header-anchor">#</a> 四 请实现一个bind函数</h2> <div class="language- extra-class"><pre class="language-text"><code>Function.prototype.bind2 = function (context) {

  if (typeof this !== &quot;function&quot;) {
    throw new Error(&quot;Function.prototype.bind - what is trying to be bound is not callable&quot;);
  }

  var self = this;
  var args = Array.prototype.slice.call(arguments, 1);

  var fNOP = function () {};

  var fBound = function () {
      var bindArgs = Array.prototype.slice.call(arguments);
      return self.apply(this instanceof fNOP ? this : context, args.concat(bindArgs));
  }

  fNOP.prototype = this.prototype;
  fBound.prototype = new fNOP();
  return fBound;
}
</code></pre></div><h2 id="五-请实现一个-json-stringify-和-json-parse"><a href="#五-请实现一个-json-stringify-和-json-parse" aria-hidden="true" class="header-anchor">#</a> 五 请实现一个 JSON.stringify 和 JSON.parse ????????????????????</h2> <div class="language- extra-class"><pre class="language-text"><code>function Car (color) {
    this.color = color
}
Car.prototype.run = function () {
    console.log(this.color + 'id run')
}
var Cruze = function (color) {
    Car.call(this, color)
}
var _prototype = Object.create(Car.prototype)
_prototype.constructor = Cruze
Cruze.prototype = _prototype
Cruze.prototype.gogo = function () {
    console.log('gogo')
}
var result = new Cruze('red')
console.log(result)
var result2 = new Car('blue')
console.log(result2)
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">有志者，事竞成；苦心人，天不负: </span> <span class="time">8/27/2019, 11:17:59 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/functional/博文.html" class="prev">
          相关博文
        </a></span> <span class="next"><a href="/git/basic.html">
          基本操作
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.6ba358d5.js" defer></script><script src="/assets/js/2.ae98e73b.js" defer></script><script src="/assets/js/54.cc3b4480.js" defer></script>
  </body>
</html>
