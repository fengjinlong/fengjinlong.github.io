<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>PromiseåŸºç¡€ | ä¸ªäººåšå®¢</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/assets/css/0.styles.d9af7a00.css" as="style"><link rel="preload" href="/assets/js/app.6ba358d5.js" as="script"><link rel="preload" href="/assets/js/2.ae98e73b.js" as="script"><link rel="preload" href="/assets/js/27.b5e919f8.js" as="script"><link rel="prefetch" href="/assets/js/10.42ff595e.js"><link rel="prefetch" href="/assets/js/11.4ed22736.js"><link rel="prefetch" href="/assets/js/12.6a6a3966.js"><link rel="prefetch" href="/assets/js/13.2dc17c00.js"><link rel="prefetch" href="/assets/js/14.ecd84e84.js"><link rel="prefetch" href="/assets/js/15.8e63941b.js"><link rel="prefetch" href="/assets/js/16.20bbf036.js"><link rel="prefetch" href="/assets/js/17.cee65893.js"><link rel="prefetch" href="/assets/js/18.210997b6.js"><link rel="prefetch" href="/assets/js/19.6a9e1c28.js"><link rel="prefetch" href="/assets/js/20.58544cb3.js"><link rel="prefetch" href="/assets/js/21.13c2449f.js"><link rel="prefetch" href="/assets/js/22.b999c181.js"><link rel="prefetch" href="/assets/js/23.ba0e1341.js"><link rel="prefetch" href="/assets/js/24.4d053282.js"><link rel="prefetch" href="/assets/js/25.afea9c0f.js"><link rel="prefetch" href="/assets/js/26.eebee834.js"><link rel="prefetch" href="/assets/js/28.eb2b8d47.js"><link rel="prefetch" href="/assets/js/29.39ddf55c.js"><link rel="prefetch" href="/assets/js/3.01798808.js"><link rel="prefetch" href="/assets/js/30.6d0c38c0.js"><link rel="prefetch" href="/assets/js/31.ae50bd7b.js"><link rel="prefetch" href="/assets/js/32.8f993527.js"><link rel="prefetch" href="/assets/js/33.e7076b44.js"><link rel="prefetch" href="/assets/js/34.02650f79.js"><link rel="prefetch" href="/assets/js/35.78660043.js"><link rel="prefetch" href="/assets/js/36.5720a95b.js"><link rel="prefetch" href="/assets/js/37.61ee918b.js"><link rel="prefetch" href="/assets/js/38.dfa679d1.js"><link rel="prefetch" href="/assets/js/39.ed80ae84.js"><link rel="prefetch" href="/assets/js/4.086bf268.js"><link rel="prefetch" href="/assets/js/40.984dfb70.js"><link rel="prefetch" href="/assets/js/41.39b0efef.js"><link rel="prefetch" href="/assets/js/42.348c0630.js"><link rel="prefetch" href="/assets/js/43.af859649.js"><link rel="prefetch" href="/assets/js/44.231224a1.js"><link rel="prefetch" href="/assets/js/45.58ade8a2.js"><link rel="prefetch" href="/assets/js/46.87a325ea.js"><link rel="prefetch" href="/assets/js/47.639c4fd3.js"><link rel="prefetch" href="/assets/js/48.17b33593.js"><link rel="prefetch" href="/assets/js/49.f5dc4f70.js"><link rel="prefetch" href="/assets/js/5.33e71d3e.js"><link rel="prefetch" href="/assets/js/50.e91de543.js"><link rel="prefetch" href="/assets/js/51.8e808c23.js"><link rel="prefetch" href="/assets/js/52.210b18bf.js"><link rel="prefetch" href="/assets/js/53.51bb9c18.js"><link rel="prefetch" href="/assets/js/54.cc3b4480.js"><link rel="prefetch" href="/assets/js/55.d360f572.js"><link rel="prefetch" href="/assets/js/56.2a89706d.js"><link rel="prefetch" href="/assets/js/6.45b5ea40.js"><link rel="prefetch" href="/assets/js/7.227a1975.js"><link rel="prefetch" href="/assets/js/8.9cffc684.js"><link rel="prefetch" href="/assets/js/9.62b6f021.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d9af7a00.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">ä¸ªäººåšå®¢</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">vue</a></div><div class="nav-item"><a href="/" class="nav-link">css</a></div><div class="nav-item"><a href="/" class="nav-link">js</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">github</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/fengjinlong" target="_blank" rel="noopener noreferrer" class="nav-link external">
  1
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fengjinlong" target="_blank" rel="noopener noreferrer" class="nav-link external">
  2
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">vue</a></div><div class="nav-item"><a href="/" class="nav-link">css</a></div><div class="nav-item"><a href="/" class="nav-link">js</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">github</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/fengjinlong" target="_blank" rel="noopener noreferrer" class="nav-link external">
  1
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fengjinlong" target="_blank" rel="noopener noreferrer" class="nav-link external">
  2
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>JavaScript</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/js/defineProperty.html" class="sidebar-link">Objectå±æ€§ç³»åˆ—</a></li><li><a href="/js/Decorator.html" class="sidebar-link">Decorators</a></li><li><a href="/js/Decorator2.html" class="sidebar-link">Decorator åº”ç”¨</a></li><li><a href="/js/eventBus.html" class="sidebar-link">eventBus</a></li><li><a href="/js/æ¨¡å—.html" class="sidebar-link">æ¨¡å—</a></li><li><a href="/js/bind&amp;new.html" class="sidebar-link">bind</a></li><li><a href="/js/es5.html" class="sidebar-link">ES5</a></li><li><a href="/js/es6.html" class="sidebar-link">ES6</a></li><li><a href="/js/è¯­è¨€ç²¾é«“.html" class="sidebar-link">åŸå‹</a></li><li><a href="/js/promise.html" class="active sidebar-link">PromiseåŸºç¡€</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js/promise.html#_1-promise-çš„å«ä¹‰" class="sidebar-link">1 Promise çš„å«ä¹‰</a></li><li class="sidebar-sub-header"><a href="/js/promise.html#_2-åŸºæœ¬ç”¨æ³•" class="sidebar-link">2 åŸºæœ¬ç”¨æ³•</a></li><li class="sidebar-sub-header"><a href="/js/promise.html#_3-promise-prototype-then" class="sidebar-link">3 Promise.prototype.then()</a></li><li class="sidebar-sub-header"><a href="/js/promise.html#_4-promise-prototype-catch" class="sidebar-link">4 Promise.prototype.catch()</a></li><li class="sidebar-sub-header"><a href="/js/promise.html#_5-promise-prototype-finally" class="sidebar-link">5 Promise.prototype.finally()</a></li><li class="sidebar-sub-header"><a href="/js/promise.html#_6-promise-all" class="sidebar-link">6 Promise.all()</a></li><li class="sidebar-sub-header"><a href="/js/promise.html#_7-promise-race" class="sidebar-link">7 Promise.race()</a></li><li class="sidebar-sub-header"><a href="/js/promise.html#_8-promise-any" class="sidebar-link">8 Promise.any()</a></li><li class="sidebar-sub-header"><a href="/js/promise.html#_9-promise-resolve" class="sidebar-link">9 Promise.resolve()</a></li><li class="sidebar-sub-header"><a href="/js/promise.html#_10-promise-reject" class="sidebar-link">10 Promise.reject()</a></li><li class="sidebar-sub-header"><a href="/js/promise.html#_11-åº”ç”¨" class="sidebar-link">11 åº”ç”¨</a></li><li class="sidebar-sub-header"><a href="/js/promise.html#_12-æ‰§è¡Œç‰¹ç‚¹" class="sidebar-link">12 æ‰§è¡Œç‰¹ç‚¹</a></li><li class="sidebar-sub-header"><a href="/js/promise.html#_13-å®šä¹‰æ„é€ å‡½æ•°" class="sidebar-link">13 å®šä¹‰æ„é€ å‡½æ•°</a></li><li class="sidebar-sub-header"><a href="/js/promise.html#promise-ç‰¹æ€§" class="sidebar-link">Promise ç‰¹æ€§</a></li><li class="sidebar-sub-header"><a href="/js/promise.html#å®ç°resolveã€rejectæ–¹æ³•ï¼Œthenæ–¹æ³•å’ŒçŠ¶æ€æœºåˆ¶" class="sidebar-link">å®ç°resolveã€rejectæ–¹æ³•ï¼Œthenæ–¹æ³•å’ŒçŠ¶æ€æœºåˆ¶</a></li><li class="sidebar-sub-header"><a href="/js/promise.html#å®ç°å¼‚æ­¥" class="sidebar-link">å®ç°å¼‚æ­¥</a></li><li class="sidebar-sub-header"><a href="/js/promise.html#å¤„ç†é”™è¯¯" class="sidebar-link">å¤„ç†é”™è¯¯</a></li><li class="sidebar-sub-header"><a href="/js/promise.html#å®ç°thençš„é“¾å¼è°ƒç”¨ï¼ˆéš¾ç‚¹ï¼‰promiseçš„thenæ–¹æ³•å®ç°é“¾å¼è°ƒç”¨çš„åŸç†æ˜¯ï¼šè¿”å›ä¸€ä¸ªæ–°çš„promise" class="sidebar-link">å®ç°thençš„é“¾å¼è°ƒç”¨ï¼ˆéš¾ç‚¹ï¼‰Promiseçš„thenæ–¹æ³•å®ç°é“¾å¼è°ƒç”¨çš„åŸç†æ˜¯ï¼šè¿”å›ä¸€ä¸ªæ–°çš„Promise</a></li><li class="sidebar-sub-header"><a href="/js/promise.html#æœªå®Œå¾…ç»­" class="sidebar-link">æœªå®Œå¾…ç»­</a></li><li class="sidebar-sub-header"><a href="/js/promise.html#async-æ˜¯ä¸€ç§è¯­æ³•ï¼Œpromise-æ˜¯ä¸€ä¸ªå†…ç½®å¯¹è±¡ï¼Œä¸¤è€…å¹¶ä¸å…·å¤‡å¯æ¯”æ€§" class="sidebar-link">async æ˜¯ä¸€ç§è¯­æ³•ï¼ŒPromise æ˜¯ä¸€ä¸ªå†…ç½®å¯¹è±¡ï¼Œä¸¤è€…å¹¶ä¸å…·å¤‡å¯æ¯”æ€§</a></li><li class="sidebar-sub-header"><a href="/js/promise.html#async-await-æ˜¯å»ºç«‹åœ¨-promiseæœºåˆ¶ä¹‹ä¸Šçš„ï¼Œå¹¶ä¸èƒ½å–ä»£å…¶åœ°ä½ã€‚" class="sidebar-link">async-await æ˜¯å»ºç«‹åœ¨ promiseæœºåˆ¶ä¹‹ä¸Šçš„ï¼Œå¹¶ä¸èƒ½å–ä»£å…¶åœ°ä½ã€‚</a></li><li class="sidebar-sub-header"><a href="/js/promise.html#asyncç”¨æ¥è¡¨ç¤ºå‡½æ•°æ˜¯å¼‚æ­¥çš„ï¼Œå®šä¹‰çš„å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªpromiseå¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨thenæ–¹æ³•æ·»åŠ å›è°ƒå‡½æ•°ã€‚" class="sidebar-link">asyncç”¨æ¥è¡¨ç¤ºå‡½æ•°æ˜¯å¼‚æ­¥çš„ï¼Œå®šä¹‰çš„å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªpromiseå¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨thenæ–¹æ³•æ·»åŠ å›è°ƒå‡½æ•°ã€‚</a></li><li class="sidebar-sub-header"><a href="/js/promise.html#await-å¯ä»¥ç†è§£ä¸ºæ˜¯-async-wait-çš„ç®€å†™ã€‚await-å¿…é¡»å‡ºç°åœ¨-async-å‡½æ•°å†…éƒ¨ï¼Œä¸èƒ½å•ç‹¬ä½¿ç”¨ã€‚" class="sidebar-link">await å¯ä»¥ç†è§£ä¸ºæ˜¯ async wait çš„ç®€å†™ã€‚await å¿…é¡»å‡ºç°åœ¨ async å‡½æ•°å†…éƒ¨ï¼Œä¸èƒ½å•ç‹¬ä½¿ç”¨ã€‚</a></li><li class="sidebar-sub-header"><a href="/js/promise.html#awaitå¿…é¡»æ¥ä¸€ä¸ªpromiseå¯¹è±¡çš„å†³è®®" class="sidebar-link">awaitå¿…é¡»æ¥ä¸€ä¸ªpromiseå¯¹è±¡çš„å†³è®®</a></li><li class="sidebar-sub-header"><a href="/js/promise.html#ä½ æœ‰ä¸‰ä¸ªè¯·æ±‚éœ€è¦å‘ç”Ÿï¼Œç¬¬ä¸‰ä¸ªè¯·æ±‚æ˜¯ä¾èµ–äºç¬¬äºŒä¸ªè¯·æ±‚çš„è§£æ„ç¬¬äºŒä¸ªè¯·æ±‚ä¾èµ–äºç¬¬ä¸€ä¸ªè¯·æ±‚çš„ç»“æœã€‚ç”¨-f" class="sidebar-link">ä½ æœ‰ä¸‰ä¸ªè¯·æ±‚éœ€è¦å‘ç”Ÿï¼Œç¬¬ä¸‰ä¸ªè¯·æ±‚æ˜¯ä¾èµ–äºç¬¬äºŒä¸ªè¯·æ±‚çš„è§£æ„ç¬¬äºŒä¸ªè¯·æ±‚ä¾èµ–äºç¬¬ä¸€ä¸ªè¯·æ±‚çš„ç»“æœã€‚ç”¨ f()</a></li><li class="sidebar-sub-header"><a href="/js/promise.html#æœ‰ä¸‰ä¸ªå¼‚æ­¥è¯·æ±‚éœ€è¦å‘é€ï¼Œç›¸äº’æ²¡æœ‰å…³è”ï¼Œåªæ˜¯éœ€è¦å½“è¯·æ±‚éƒ½ç»“æŸåå°†ç•Œé¢çš„-loading-æ¸…é™¤æ‰å³å¯ã€‚ç”¨-t" class="sidebar-link">æœ‰ä¸‰ä¸ªå¼‚æ­¥è¯·æ±‚éœ€è¦å‘é€ï¼Œç›¸äº’æ²¡æœ‰å…³è”ï¼Œåªæ˜¯éœ€è¦å½“è¯·æ±‚éƒ½ç»“æŸåå°†ç•Œé¢çš„ loading æ¸…é™¤æ‰å³å¯ã€‚ç”¨ t()</a></li></ul></li><li><a href="/js/promiseæ€è·¯.html" class="sidebar-link">æ‰‹å†™æ€è·¯</a></li><li><a href="/js/æ·±æ‹·è´.html" class="sidebar-link">æ·±æ‹·è´</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTML</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>http</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>docker</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æ€§èƒ½</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>yarn</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>php</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>node</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>gulp</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>typescript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>webpack</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>mac</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>react</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>interview</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>functional</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æ‰‹å†™ä»£ç </span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JSON</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ä¼˜åŒ–</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>åšæ–‡</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="promiseåŸºç¡€"><a href="#promiseåŸºç¡€" aria-hidden="true" class="header-anchor">#</a> PromiseåŸºç¡€</h1> <h2 id="_1-promise-çš„å«ä¹‰"><a href="#_1-promise-çš„å«ä¹‰" aria-hidden="true" class="header-anchor">#</a> 1 Promise çš„å«ä¹‰</h2> <blockquote><p>Promise æ˜¯å¼‚æ­¥ç¼–ç¨‹çš„ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œæ¯”ä¼ ç»Ÿçš„è§£å†³æ–¹æ¡ˆâ€”â€”å›è°ƒå‡½æ•°å’Œäº‹ä»¶â€”â€”æ›´åˆç†å’Œæ›´å¼ºå¤§ã€‚</p></blockquote> <blockquote><p>ç‰¹ç‚¹</p> <ul><li>å¯¹è±¡çš„çŠ¶æ€ä¸å—å¤–ç•Œå½±å“ã€‚Promiseå¯¹è±¡ä»£è¡¨ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œæœ‰ä¸‰ç§çŠ¶æ€ï¼špendingï¼ˆè¿›è¡Œä¸­ï¼‰ã€fulfilledï¼ˆå·²æˆåŠŸï¼‰å’Œrejectedï¼ˆå·²å¤±è´¥ï¼‰ã€‚</li> <li>ä¸€æ—¦çŠ¶æ€æ”¹å˜ï¼Œå°±ä¸ä¼šå†å˜ï¼Œä»»ä½•æ—¶å€™éƒ½å¯ä»¥å¾—åˆ°è¿™ä¸ªç»“æœã€‚</li></ul></blockquote> <blockquote><p>Promiseä¹Ÿæœ‰ä¸€äº›ç¼ºç‚¹ã€‚</p> <ul><li>é¦–å…ˆï¼Œæ— æ³•å–æ¶ˆPromiseï¼Œä¸€æ—¦æ–°å»ºå®ƒå°±ä¼šç«‹å³æ‰§è¡Œï¼Œæ— æ³•ä¸­é€”å–æ¶ˆã€‚</li> <li>å…¶æ¬¡ï¼Œå¦‚æœä¸è®¾ç½®å›è°ƒå‡½æ•°ï¼ŒPromiseå†…éƒ¨æŠ›å‡ºçš„é”™è¯¯ï¼Œä¸ä¼šååº”åˆ°å¤–éƒ¨ã€‚</li> <li>ç¬¬ä¸‰ï¼Œå½“å¤„äºpendingçŠ¶æ€æ—¶ï¼Œæ— æ³•å¾—çŸ¥ç›®å‰è¿›å±•åˆ°å“ªä¸€ä¸ªé˜¶æ®µï¼ˆåˆšåˆšå¼€å§‹è¿˜æ˜¯å³å°†å®Œæˆï¼‰ã€‚</li> <li>å¦‚æœæŸäº›äº‹ä»¶ä¸æ–­åœ°åå¤å‘ç”Ÿï¼Œä¸€èˆ¬æ¥è¯´ï¼Œä½¿ç”¨ nodejs Stream æ¨¡å¼æ˜¯æ¯”éƒ¨ç½²Promiseæ›´å¥½çš„é€‰æ‹©ã€‚</li></ul></blockquote> <h2 id="_2-åŸºæœ¬ç”¨æ³•"><a href="#_2-åŸºæœ¬ç”¨æ³•" aria-hidden="true" class="header-anchor">#</a> 2 åŸºæœ¬ç”¨æ³•</h2> <div class="language- extra-class"><pre class="language-text"><code>const promise = new Promise(function(resolve, reject) {
  // ... some code

  if (/* å¼‚æ­¥æ“ä½œæˆåŠŸ */){
    resolve(value);
  } else {
    reject(error);
  }
});
</code></pre></div><blockquote><p>Promiseæ„é€ å‡½æ•°æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°çš„ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯resolveå’Œrejectã€‚å®ƒä»¬æ˜¯ä¸¤ä¸ªå‡½æ•°ï¼Œç”± <strong>JavaScript å¼•æ“æä¾›</strong>ï¼Œä¸ç”¨è‡ªå·±éƒ¨ç½²ã€‚</p></blockquote> <blockquote><p>resolveå‡½æ•°çš„ä½œç”¨æ˜¯ï¼Œå°†Promiseå¯¹è±¡çš„çŠ¶æ€ä»â€œæœªå®Œæˆâ€å˜ä¸ºâ€œæˆåŠŸâ€ï¼ˆå³ä» pending å˜ä¸º resolvedï¼‰ï¼Œåœ¨å¼‚æ­¥æ“ä½œæˆåŠŸæ—¶è°ƒç”¨ï¼Œå¹¶å°†å¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œä½œä¸ºå‚æ•°ä¼ é€’å‡ºå»ï¼›rejectå‡½æ•°çš„ä½œç”¨æ˜¯ï¼Œå°†Promiseå¯¹è±¡çš„çŠ¶æ€ä»â€œæœªå®Œæˆâ€å˜ä¸ºâ€œå¤±è´¥â€ï¼ˆå³ä» pending å˜ä¸º rejectedï¼‰ï¼Œåœ¨å¼‚æ­¥æ“ä½œå¤±è´¥æ—¶è°ƒç”¨ï¼Œå¹¶å°†å¼‚æ­¥æ“ä½œæŠ¥å‡ºçš„é”™è¯¯ï¼Œä½œä¸ºå‚æ•°ä¼ é€’å‡ºå»</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>promise.then(function(value) {
  // success
}, function(error) {
  // failure
});
</code></pre></div><blockquote><p>Promise æ–°å»ºåå°±ä¼šç«‹å³æ‰§è¡Œ</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>Promise æ–°å»ºåç«‹å³æ‰§è¡Œï¼Œæ‰€ä»¥é¦–å…ˆè¾“å‡ºçš„æ˜¯Promise

let promise = new Promise(function(resolve, reject) {
  console.log('Promise');
  resolve();
});

promise.then(function() {
  console.log('resolved.');
});

console.log('Hi!');

// Promise
// Hi!
// resolved
</code></pre></div><blockquote><p>å¼‚æ­¥åŠ è½½å›¾ç‰‡çš„ä¾‹å­</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>function loadImg (url) {
  return new Promise((resolve, reject) =&gt; {
    const image = new Image();
    image.onload = () =&gt; {
      resolve(image)
    }
    image.onerror = () =&gt; {
      reject(new Error('Could not load image at ' + url));
    };
    images.src = url;
  })
}
</code></pre></div><blockquote><p>ç”¨Promiseå¯¹è±¡å®ç°çš„ Ajax æ“ä½œçš„ä¾‹å­</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>const getJSON = function(url) {
  const promise = new Promise(function(resolve, reject){
    const handler = function() {
      if (this.readyState !== 4) {
        return;
      }
      if (this.status === 200) {
        resolve(this.response);
      } else {
        reject(new Error(this.statusText));
      }
    };
    const client = new XMLHttpRequest();
    client.open(&quot;GET&quot;, url);
    client.onreadystatechange = handler;
    client.responseType = &quot;json&quot;;
    client.setRequestHeader(&quot;Accept&quot;, &quot;application/json&quot;);
    client.send();

  });

  return promise;
};

getJSON(&quot;/posts.json&quot;).then(function(json) {
  console.log('Contents: ' + json);
}, function(error) {
  console.error('å‡ºé”™äº†', error);
});
</code></pre></div><blockquote><p>resolveå‡½æ•°çš„å‚æ•°é™¤äº†æ­£å¸¸çš„å€¼ä»¥å¤–ï¼Œè¿˜å¯èƒ½æ˜¯å¦ä¸€ä¸ª Promise å®ä¾‹</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>const p1 = new Promise(function (resolve, reject) {
  setTimeout(() =&gt; reject(new Error('fail')), 3000)
})

const p2 = new Promise(function (resolve, reject) {
  setTimeout(() =&gt; resolve(p1), 1000)
})

p2
  .then(result =&gt; console.log(result))
  .catch(error =&gt; console.log(error))
// Error: fail
</code></pre></div><blockquote><p>ä¸Šé¢ä»£ç ä¸­ï¼Œp1æ˜¯ä¸€ä¸ª Promiseï¼Œ3 ç§’ä¹‹åå˜ä¸ºrejectedã€‚p2çš„çŠ¶æ€åœ¨ 1 ç§’ä¹‹åæ”¹å˜ï¼Œresolveæ–¹æ³•è¿”å›çš„æ˜¯p1ã€‚ç”±äº<strong>p2è¿”å›çš„æ˜¯å¦ä¸€ä¸ª Promiseï¼Œå¯¼è‡´p2è‡ªå·±çš„çŠ¶æ€</strong>æ— æ•ˆäº†ï¼Œç”±p1çš„çŠ¶æ€å†³å®šp2çš„çŠ¶æ€ã€‚æ‰€ä»¥ï¼Œåé¢çš„thenè¯­å¥éƒ½å˜æˆé’ˆå¯¹åè€…ï¼ˆp1ï¼‰ã€‚åˆè¿‡äº† 2 ç§’ï¼Œp1å˜ä¸ºrejectedï¼Œå¯¼è‡´è§¦å‘catchæ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°ã€‚</p></blockquote> <blockquote><p>è°ƒç”¨resolveæˆ–rejectå¹¶ä¸ä¼šç»ˆç»“ Promise çš„å‚æ•°å‡½æ•°çš„æ‰§è¡Œ</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>new Promise((resolve, reject) =&gt; {
  resolve(1);
  console.log(2);
}).then(r =&gt; {
  console.log(r);
});
// 2
// 1
</code></pre></div><blockquote><p>ä¸Šé¢ä»£ç ä¸­ï¼Œè°ƒç”¨resolve(1)ä»¥åï¼Œåé¢çš„console.log(2)è¿˜æ˜¯ä¼šæ‰§è¡Œï¼Œå¹¶ä¸”ä¼šé¦–å…ˆæ‰“å°å‡ºæ¥ã€‚è¿™æ˜¯å› ä¸ºç«‹å³ resolved çš„ Promise æ˜¯åœ¨æœ¬è½®äº‹ä»¶å¾ªç¯çš„æœ«å°¾æ‰§è¡Œï¼Œæ€»æ˜¯<strong>æ™šäºæœ¬è½®å¾ªç¯çš„åŒæ­¥ä»»åŠ¡</strong>ã€‚</p></blockquote> <blockquote><p>ä¸€èˆ¬æ¥è¯´ï¼Œè°ƒç”¨resolveæˆ–rejectä»¥åï¼ŒPromise çš„ä½¿å‘½å°±å®Œæˆäº†ï¼Œåç»§æ“ä½œåº”è¯¥æ”¾åˆ°thenæ–¹æ³•é‡Œé¢ï¼Œè€Œä¸åº”è¯¥ç›´æ¥å†™åœ¨resolveæˆ–rejectçš„åé¢ã€‚æ‰€ä»¥ï¼Œ<strong>æœ€å¥½åœ¨å®ƒä»¬å‰é¢åŠ ä¸Šreturnè¯­å¥ï¼Œè¿™æ ·å°±ä¸ä¼šæœ‰æ„å¤–</strong></p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>new Promise((resolve, reject) =&gt; {
  return resolve(1);
  // åé¢çš„è¯­å¥ä¸ä¼šæ‰§è¡Œ
  console.log(2);
})
</code></pre></div><h2 id="_3-promise-prototype-then"><a href="#_3-promise-prototype-then" aria-hidden="true" class="header-anchor">#</a> 3 Promise.prototype.then()</h2> <blockquote><p>Promise å®ä¾‹å…·æœ‰thenæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œthenæ–¹æ³•æ˜¯å®šä¹‰åœ¨åŸå‹å¯¹è±¡Promise.prototypeä¸Šçš„
thenæ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªæ–°çš„Promiseå®ä¾‹ï¼ˆæ³¨æ„ï¼Œä¸æ˜¯åŸæ¥é‚£ä¸ªPromiseå®ä¾‹ï¼‰ã€‚å› æ­¤å¯ä»¥é‡‡ç”¨é“¾å¼å†™æ³•ï¼Œå³thenæ–¹æ³•åé¢å†è°ƒç”¨å¦ä¸€ä¸ªthenæ–¹æ³•ã€‚</p></blockquote> <h2 id="_4-promise-prototype-catch"><a href="#_4-promise-prototype-catch" aria-hidden="true" class="header-anchor">#</a> 4 Promise.prototype.catch()</h2> <blockquote><p>Promise.prototype.catchæ–¹æ³•æ˜¯.then(null, rejection)æˆ–.then(undefined, rejection)çš„åˆ«åï¼Œç”¨äºæŒ‡å®šå‘ç”Ÿé”™è¯¯æ—¶çš„å›è°ƒå‡½æ•°ã€‚</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>p.then((val) =&gt; console.log('fulfilled:', val))
  .catch((err) =&gt; console.log('rejected', err));

// ç­‰åŒäº
p.then((val) =&gt; console.log('fulfilled:', val))
  .then(null, (err) =&gt; console.log(&quot;rejected:&quot;, err));
</code></pre></div><blockquote><p>ä¸Šé¢ä»£ç ä¸­ï¼ŒpromiseæŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œå°±è¢«catchæ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°æ•è·ã€‚æ³¨æ„ï¼Œä¸Šé¢çš„å†™æ³•ä¸ä¸‹é¢ä¸¤ç§å†™æ³•æ˜¯ç­‰ä»·çš„ã€‚</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>// å†™æ³•ä¸€
const promise = new Promise(function(resolve, reject) {
  try {
    throw new Error('test');
  } catch(e) {
    reject(e);
  }
});
promise.catch(function(error) {
  console.log(error);
});

// å†™æ³•äºŒ
const promise = new Promise(function(resolve, reject) {
  reject(new Error('test'));
});
promise.catch(function(error) {
  console.log(error);
});
</code></pre></div><blockquote><p>å¦‚æœ Promise çŠ¶æ€å·²ç»å˜æˆresolvedï¼Œå†æŠ›å‡ºé”™è¯¯æ˜¯æ— æ•ˆçš„</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>const promise = new Promise(function(resolve, reject) {
  resolve('ok');
  throw new Error('test');
});
promise
  .then(function(value) { console.log(value) })
  .catch(function(error) { console.log(error) });
// ok
</code></pre></div><blockquote><p>Promise å¯¹è±¡çš„é”™è¯¯å…·æœ‰â€œå†’æ³¡â€æ€§è´¨ï¼Œä¼šä¸€ç›´å‘åä¼ é€’ï¼Œç›´åˆ°è¢«æ•è·ä¸ºæ­¢ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé”™è¯¯æ€»æ˜¯ä¼šè¢«ä¸‹ä¸€ä¸ªcatchè¯­å¥æ•è·ã€‚</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>getJSON('/post/1.json').then(function(post) {
  return getJSON(post.commentURL);
}).then(function(comments) {
  // some code
}).catch(function(error) {
  // å¤„ç†å‰é¢ä¸‰ä¸ªPromiseäº§ç”Ÿçš„é”™è¯¯
});
</code></pre></div><blockquote><p>ä¸Šé¢ä»£ç ä¸­ï¼Œä¸€å…±æœ‰ä¸‰ä¸ª Promise å¯¹è±¡ï¼šä¸€ä¸ªç”±getJSONäº§ç”Ÿï¼Œä¸¤ä¸ªç”±thenäº§ç”Ÿã€‚å®ƒä»¬ä¹‹ä¸­ä»»ä½•ä¸€ä¸ªæŠ›å‡ºçš„é”™è¯¯ï¼Œéƒ½ä¼šè¢«æœ€åä¸€ä¸ªcatchæ•è·ã€‚</p></blockquote> <blockquote><p>ä¸€èˆ¬æ¥è¯´ï¼Œ<strong>ä¸è¦</strong>åœ¨thenæ–¹æ³•é‡Œé¢å®šä¹‰ Reject çŠ¶æ€çš„å›è°ƒå‡½æ•°ï¼ˆå³thençš„ç¬¬äºŒä¸ªå‚æ•°ï¼‰ï¼Œæ€»æ˜¯ä½¿ç”¨catchæ–¹æ³•ã€‚</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>// bad
promise
  .then(function(data) {
    // success
  }, function(err) {
    // error
  });

// good
promise
  .then(function(data) { //cb
    // success
  })
  .catch(function(err) {
    // error
  });
</code></pre></div><blockquote><p>è·Ÿä¼ ç»Ÿçš„<strong>try/catch</strong>ä»£ç å—ä¸åŒçš„æ˜¯ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨catchæ–¹æ³•æŒ‡å®šé”™è¯¯å¤„ç†çš„å›è°ƒå‡½æ•°ï¼ŒPromise å¯¹è±¡æŠ›å‡ºçš„é”™è¯¯ä¸ä¼š<strong>ä¼ é€’åˆ°å¤–å±‚ä»£ç ï¼Œå³ä¸ä¼šæœ‰ä»»ä½•ååº”</strong></p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>const someAsyncThing = function() {
  return new Promise(function(resolve, reject) {
    // ä¸‹é¢ä¸€è¡Œä¼šæŠ¥é”™ï¼Œå› ä¸ºxæ²¡æœ‰å£°æ˜
    resolve(x + 2);
  });
};

someAsyncThing().then(function() {
  console.log('everything is great');
});

setTimeout(() =&gt; { console.log(123) }, 2000);
// Uncaught (in promise) ReferenceError: x is not defined
// 123
</code></pre></div><blockquote><p>ä¸Šé¢ä»£ç ä¸­ï¼ŒsomeAsyncThingå‡½æ•°äº§ç”Ÿçš„ Promise å¯¹è±¡ï¼Œå†…éƒ¨æœ‰è¯­æ³•é”™è¯¯ã€‚æµè§ˆå™¨è¿è¡Œåˆ°è¿™ä¸€è¡Œï¼Œä¼šæ‰“å°å‡ºé”™è¯¯æç¤ºReferenceError: x is not definedï¼Œä½†æ˜¯ä¸ä¼šé€€å‡ºè¿›ç¨‹ã€ç»ˆæ­¢è„šæœ¬æ‰§è¡Œï¼Œ2 ç§’ä¹‹åè¿˜æ˜¯ä¼šè¾“å‡º123ã€‚è¿™å°±æ˜¯è¯´ï¼ŒPromise å†…éƒ¨çš„é”™è¯¯ä¸ä¼šå½±å“åˆ° Promise å¤–éƒ¨çš„ä»£ç ï¼Œé€šä¿—çš„è¯´æ³•å°±æ˜¯â€œPromise ä¼šåƒæ‰é”™è¯¯â€ã€‚</p></blockquote> <blockquote><p>ä¸€èˆ¬æ€»æ˜¯å»ºè®®ï¼ŒPromise å¯¹è±¡åé¢è¦è·Ÿcatchæ–¹æ³•ï¼Œè¿™æ ·å¯ä»¥å¤„ç† Promise å†…éƒ¨å‘ç”Ÿçš„é”™è¯¯ã€‚catchæ–¹æ³•è¿”å›çš„è¿˜æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ï¼Œå› æ­¤åé¢è¿˜å¯ä»¥æ¥ç€è°ƒç”¨thenæ–¹æ³•ã€‚</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>someAsyncThing().then(function() {
  return someOtherAsyncThing();
}).catch(function(error) {
  console.log('oh no', error);
  // ä¸‹é¢ä¸€è¡Œä¼šæŠ¥é”™ï¼Œå› ä¸ºyæ²¡æœ‰å£°æ˜
  y + 2;
}).catch(function(error) {
  console.log('carry on', error);
});
// oh no [ReferenceError: x is not defined]
// carry on [ReferenceError: y is not defined]
</code></pre></div><blockquote><p>ä¸Šé¢ä»£ç ä¸­ï¼Œç¬¬äºŒä¸ªcatchæ–¹æ³•ç”¨æ¥æ•è·å‰ä¸€ä¸ªcatchæ–¹æ³•æŠ›å‡ºçš„é”™è¯¯</p></blockquote> <h2 id="_5-promise-prototype-finally"><a href="#_5-promise-prototype-finally" aria-hidden="true" class="header-anchor">#</a> 5 Promise.prototype.finally()</h2> <blockquote><p>finallyæ–¹æ³•ç”¨äºæŒ‡å®šä¸ç®¡ Promise å¯¹è±¡æœ€åçŠ¶æ€å¦‚ä½•ï¼Œéƒ½ä¼šæ‰§è¡Œçš„æ“ä½œ
æœåŠ¡å™¨ä½¿ç”¨ Promise å¤„ç†è¯·æ±‚ï¼Œç„¶åä½¿ç”¨finallyæ–¹æ³•å…³æ‰æœåŠ¡å™¨ã€‚</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>server.listen(port)
  .then(function () {
    // ...
  })
  .finally(server.stop);
</code></pre></div><blockquote><p>finallyæœ¬è´¨ä¸Šæ˜¯thenæ–¹æ³•çš„ç‰¹ä¾‹ã€‚</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>promise
.finally(() =&gt; {
  // è¯­å¥
});

// ç­‰åŒäº
promise
.then(
  result =&gt; {
    // è¯­å¥
    return result;
  },
  error =&gt; {
    // è¯­å¥
    throw error;
  }
);
</code></pre></div><blockquote><p>ä¸Šé¢ä»£ç ä¸­ï¼Œå¦‚æœä¸ä½¿ç”¨finallyæ–¹æ³•ï¼ŒåŒæ ·çš„è¯­å¥éœ€è¦ä¸ºæˆåŠŸå’Œå¤±è´¥ä¸¤ç§æƒ…å†µå„å†™ä¸€æ¬¡ã€‚æœ‰äº†finallyæ–¹æ³•ï¼Œåˆ™åªéœ€è¦å†™ä¸€æ¬¡ã€‚
å®ƒçš„å®ç°ä¹Ÿå¾ˆç®€å•</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>Promise.prototype.finally = function (callback) {
  let P = this.constructor;
  return this.then(
    value  =&gt; P.resolve(callback()).then(() =&gt; value),
    reason =&gt; P.resolve(callback()).then(() =&gt; { throw reason })
  );
};
</code></pre></div><h2 id="_6-promise-all"><a href="#_6-promise-all" aria-hidden="true" class="header-anchor">#</a> 6 Promise.all()</h2> <blockquote><p>const p = Promise.all([p1, p2, p3]);</p></blockquote> <blockquote><p>Promise.all()æ–¹æ³•æ¥å—ä¸€ä¸ªæ•°ç»„ä½œä¸ºå‚æ•°ï¼Œp1ã€p2ã€p3éƒ½æ˜¯ Promise å®ä¾‹ï¼Œå¦‚æœä¸æ˜¯ï¼Œå°±ä¼šå…ˆè°ƒç”¨ä¸‹é¢è®²åˆ°çš„Promise.resolveæ–¹æ³•ï¼Œå°†å‚æ•°è½¬ä¸º Promise å®ä¾‹ï¼Œå†è¿›ä¸€æ­¥å¤„ç†ã€‚</p></blockquote> <blockquote><p>å¦å¤–ï¼ŒPromise.all()æ–¹æ³•çš„å‚æ•°å¯ä»¥ä¸æ˜¯æ•°ç»„ï¼Œä½†å¿…é¡»å…·æœ‰ Iterator æ¥å£ï¼Œä¸”è¿”å›çš„æ¯ä¸ªæˆå‘˜éƒ½æ˜¯ Promise å®ä¾‹ã€‚</p></blockquote> <blockquote><p>åªæœ‰p1ã€p2ã€p3çš„çŠ¶æ€éƒ½å˜æˆfulfilledï¼Œpçš„çŠ¶æ€æ‰ä¼šå˜æˆfulfilledï¼Œæ­¤æ—¶p1ã€p2ã€p3çš„è¿”å›å€¼ç»„æˆä¸€ä¸ªæ•°ç»„ï¼Œä¼ é€’ç»™pçš„å›è°ƒå‡½æ•°ã€‚</p></blockquote> <blockquote><p>åªè¦p1ã€p2ã€p3ä¹‹ä¸­æœ‰ä¸€ä¸ªè¢«rejectedï¼Œpçš„çŠ¶æ€å°±å˜æˆrejectedï¼Œæ­¤æ—¶ç¬¬ä¸€ä¸ªè¢«rejectçš„å®ä¾‹çš„è¿”å›å€¼ï¼Œä¼šä¼ é€’ç»™pçš„å›è°ƒå‡½æ•°ã€‚</p></blockquote> <h2 id="_7-promise-race"><a href="#_7-promise-race" aria-hidden="true" class="header-anchor">#</a> 7 Promise.race()</h2> <blockquote><p>åªè¦p1ã€p2ã€p3ä¹‹ä¸­æœ‰ä¸€ä¸ªå®ä¾‹ç‡å…ˆæ”¹å˜çŠ¶æ€ï¼Œpçš„çŠ¶æ€å°±è·Ÿç€æ”¹å˜</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>const p = Promise.race([
  fetch('/resource-that-may-take-a-while'),
  new Promise(function (resolve, reject) {
    setTimeout(() =&gt; reject(new Error('request timeout')), 5000)
  })
]);

p
.then(console.log)
.catch(console.error);
</code></pre></div><blockquote><p>å¦‚æœ 5 ç§’ä¹‹å†…fetchæ–¹æ³•æ— æ³•è¿”å›ç»“æœï¼Œå˜é‡pçš„çŠ¶æ€å°±ä¼šå˜ä¸ºrejectedï¼Œä»è€Œè§¦å‘catchæ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°ã€‚</p></blockquote> <h2 id="_8-promise-any"><a href="#_8-promise-any" aria-hidden="true" class="header-anchor">#</a> 8 Promise.any()</h2> <blockquote><p>Promise.any()æ–¹æ³•æ¥å—ä¸€ç»„ Promise å®ä¾‹ä½œä¸ºå‚æ•°ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ã€‚åªè¦å‚æ•°å®ä¾‹æœ‰ä¸€ä¸ªå˜æˆfulfilledçŠ¶æ€ï¼ŒåŒ…è£…å®ä¾‹å°±ä¼šå˜æˆfulfilledçŠ¶æ€ï¼›å¦‚æœæ‰€æœ‰å‚æ•°å®ä¾‹éƒ½å˜æˆrejectedçŠ¶æ€ï¼ŒåŒ…è£…å®ä¾‹å°±ä¼šå˜æˆrejectedçŠ¶æ€ã€‚</p></blockquote> <h2 id="_9-promise-resolve"><a href="#_9-promise-resolve" aria-hidden="true" class="header-anchor">#</a> 9 Promise.resolve()</h2> <blockquote><p>æœ‰æ—¶éœ€è¦å°†ç°æœ‰å¯¹è±¡è½¬ä¸º Promise å¯¹è±¡ï¼ŒPromise.resolve()æ–¹æ³•å°±èµ·åˆ°è¿™ä¸ªä½œç”¨ã€‚</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>const jsPromise = Promise.resolve($.ajax('/whatever.json'));
ä¸Šé¢ä»£ç å°† jQuery ç”Ÿæˆçš„deferredå¯¹è±¡ï¼Œè½¬ä¸ºä¸€ä¸ªæ–°çš„ Promise å¯¹è±¡ã€‚
</code></pre></div><blockquote><p>Promise.resolve()ç­‰ä»·äºä¸‹é¢çš„å†™æ³•ã€‚</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>Promise.resolve('foo')
// ç­‰ä»·äº
new Promise(resolve =&gt; resolve('foo'))
Promise.resolveæ–¹æ³•çš„å‚æ•°åˆ†æˆå››ç§æƒ…å†µã€‚
</code></pre></div><blockquote><p>ï¼ˆ1ï¼‰å‚æ•°æ˜¯ä¸€ä¸ª Promise å®ä¾‹</p></blockquote> <blockquote><blockquote><p>å¦‚æœå‚æ•°æ˜¯ Promise å®ä¾‹ï¼Œé‚£ä¹ˆPromise.resolveå°†ä¸åšä»»ä½•ä¿®æ”¹ã€åŸå°ä¸åŠ¨åœ°è¿”å›è¿™ä¸ªå®ä¾‹ã€‚</p></blockquote></blockquote> <blockquote><p>ï¼ˆ2ï¼‰å‚æ•°æ˜¯ä¸€ä¸ªthenableå¯¹è±¡</p></blockquote> <blockquote><blockquote><p>thenableå¯¹è±¡æŒ‡çš„æ˜¯å…·æœ‰thenæ–¹æ³•çš„å¯¹è±¡ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªå¯¹è±¡ã€‚</p></blockquote></blockquote> <div class="language- extra-class"><pre class="language-text"><code>let thenable = {
  then: function(resolve, reject) {
    resolve(42);
  }
};
Promise.resolveæ–¹æ³•ä¼šå°†è¿™ä¸ªå¯¹è±¡è½¬ä¸º Promise å¯¹è±¡ï¼Œç„¶åå°±ç«‹å³æ‰§è¡Œthenableå¯¹è±¡çš„thenæ–¹æ³•ã€‚

let thenable = {
  then: function(resolve, reject) {
    resolve(42);
  }
};

let p1 = Promise.resolve(thenable);
p1.then(function(value) {
  console.log(value);  // 42
});
</code></pre></div><blockquote><blockquote><p>ä¸Šé¢ä»£ç ä¸­ï¼Œthenableå¯¹è±¡çš„thenæ–¹æ³•æ‰§è¡Œåï¼Œå¯¹è±¡p1çš„çŠ¶æ€å°±å˜ä¸ºresolvedï¼Œä»è€Œç«‹å³æ‰§è¡Œæœ€åé‚£ä¸ªthenæ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°ï¼Œè¾“å‡º 42ã€‚</p></blockquote></blockquote> <blockquote><p>ï¼ˆ3ï¼‰å‚æ•°ä¸æ˜¯å…·æœ‰thenæ–¹æ³•çš„å¯¹è±¡ï¼Œæˆ–æ ¹æœ¬å°±ä¸æ˜¯å¯¹è±¡</p></blockquote> <blockquote><blockquote><p>å¦‚æœå‚æ•°æ˜¯ä¸€ä¸ªåŸå§‹å€¼ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªä¸å…·æœ‰thenæ–¹æ³•çš„å¯¹è±¡ï¼Œåˆ™Promise.resolveæ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„ Promise å¯¹è±¡ï¼ŒçŠ¶æ€ä¸ºresolvedã€‚</p></blockquote></blockquote> <div class="language- extra-class"><pre class="language-text"><code>const p = Promise.resolve('Hello');

p.then(function (s){
  console.log(s)
});
// Hello
</code></pre></div><blockquote><blockquote><p>ä¸Šé¢ä»£ç ç”Ÿæˆä¸€ä¸ªæ–°çš„ Promise å¯¹è±¡çš„å®ä¾‹pã€‚ç”±äºå­—ç¬¦ä¸²Helloä¸å±äºå¼‚æ­¥æ“ä½œï¼ˆåˆ¤æ–­æ–¹æ³•æ˜¯å­—ç¬¦ä¸²å¯¹è±¡ä¸å…·æœ‰ then æ–¹æ³•ï¼‰ï¼Œè¿”å› Promise å®ä¾‹çš„çŠ¶æ€ä»ä¸€ç”Ÿæˆå°±æ˜¯resolvedï¼Œæ‰€ä»¥å›è°ƒå‡½æ•°ä¼šç«‹å³æ‰§è¡Œã€‚Promise.resolveæ–¹æ³•çš„å‚æ•°ï¼Œä¼šåŒæ—¶ä¼ ç»™å›è°ƒå‡½æ•°ã€‚</p></blockquote></blockquote> <blockquote><p>ï¼ˆ4ï¼‰ä¸å¸¦æœ‰ä»»ä½•å‚æ•°</p></blockquote> <blockquote><blockquote><p>Promise.resolve()æ–¹æ³•å…è®¸è°ƒç”¨æ—¶ä¸å¸¦å‚æ•°ï¼Œç›´æ¥è¿”å›ä¸€ä¸ªresolvedçŠ¶æ€çš„ Promise å¯¹è±¡ã€‚</p></blockquote></blockquote> <blockquote><blockquote><p>æ‰€ä»¥ï¼Œå¦‚æœå¸Œæœ›å¾—åˆ°ä¸€ä¸ª Promise å¯¹è±¡ï¼Œæ¯”è¾ƒæ–¹ä¾¿çš„æ–¹æ³•å°±æ˜¯ç›´æ¥è°ƒç”¨Promise.resolve()æ–¹æ³•ã€‚</p></blockquote></blockquote> <div class="language- extra-class"><pre class="language-text"><code>const p = Promise.resolve();

p.then(function () {
  // ...
});
</code></pre></div><blockquote><blockquote><p>ä¸Šé¢ä»£ç çš„å˜é‡på°±æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ã€‚</p></blockquote></blockquote> <blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç«‹å³resolve()çš„ Promise å¯¹è±¡ï¼Œæ˜¯åœ¨<strong>æœ¬è½®â€œäº‹ä»¶å¾ªç¯â€ï¼ˆevent loopï¼‰çš„ç»“æŸæ—¶æ‰§è¡Œï¼Œè€Œä¸æ˜¯åœ¨ä¸‹ä¸€è½®â€œäº‹ä»¶å¾ªç¯â€çš„å¼€å§‹æ—¶</strong>ã€‚</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>setTimeout(function () {
  console.log('three');
}, 0);

Promise.resolve().then(function () {
  console.log('two');
});

console.log('one');

// one
// two
// three
ä¸Šé¢ä»£ç ä¸­ï¼ŒsetTimeout(fn, 0)åœ¨ä¸‹ä¸€è½®â€œäº‹ä»¶å¾ªç¯â€å¼€å§‹æ—¶æ‰§è¡Œï¼ŒPromise.resolve()åœ¨æœ¬è½®â€œäº‹ä»¶å¾ªç¯â€ç»“æŸæ—¶æ‰§è¡Œï¼Œconsole.log('one')åˆ™æ˜¯ç«‹å³æ‰§è¡Œï¼Œå› æ­¤æœ€å…ˆè¾“å‡º
</code></pre></div><h2 id="_10-promise-reject"><a href="#_10-promise-reject" aria-hidden="true" class="header-anchor">#</a> 10 Promise.reject()</h2> <blockquote><p>Promise.reject(reason)æ–¹æ³•ä¹Ÿä¼šè¿”å›ä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ï¼Œè¯¥å®ä¾‹çš„çŠ¶æ€ä¸ºrejectedã€‚</p></blockquote> <h2 id="_11-åº”ç”¨"><a href="#_11-åº”ç”¨" aria-hidden="true" class="header-anchor">#</a> 11 åº”ç”¨</h2> <blockquote><p>Generator å‡½æ•°ä¸ Promise çš„ç»“åˆ
ä½¿ç”¨ Generator å‡½æ•°ç®¡ç†æµç¨‹ï¼Œé‡åˆ°å¼‚æ­¥æ“ä½œçš„æ—¶å€™ï¼Œé€šå¸¸è¿”å›ä¸€ä¸ªPromiseå¯¹è±¡ã€‚</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>function getFoo () {
  return new Promise(function (resolve, reject){
    resolve('foo');
  });
}

const g = function* () {
  try {
    const foo = yield getFoo();
    console.log(foo);
  } catch (e) {
    console.log(e);
  }
};

function run (generator) {
  const it = generator();

  function go(result) {
    if (result.done) return result.value;

    return result.value.then(function (value) {
      return go(it.next(value));
    }, function (error) {
      return go(it.throw(error));
    });
  }

  go(it.next());
}

run(g);
</code></pre></div><blockquote><p>ä¸Šé¢ä»£ç çš„ Generator å‡½æ•°gä¹‹ä¸­ï¼Œæœ‰ä¸€ä¸ªå¼‚æ­¥æ“ä½œgetFooï¼Œå®ƒè¿”å›çš„å°±æ˜¯ä¸€ä¸ªPromiseå¯¹è±¡ã€‚å‡½æ•°runç”¨æ¥å¤„ç†è¿™ä¸ªPromiseå¯¹è±¡ï¼Œå¹¶è°ƒç”¨ä¸‹ä¸€ä¸ªnextæ–¹æ³•ã€‚</p></blockquote> <h2 id="_12-æ‰§è¡Œç‰¹ç‚¹"><a href="#_12-æ‰§è¡Œç‰¹ç‚¹" aria-hidden="true" class="header-anchor">#</a> 12 æ‰§è¡Œç‰¹ç‚¹</h2> <blockquote><ul><li>Promise æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œæ¥å—å‡½æ•°ä½œä¸ºå‚æ•°(resolve(),reject())</li> <li>Promise å¯¹è±¡æœ‰ä¸‰ç§çŠ¶æ€ pending(è¿›è¡Œä¸­), fulfilled(æˆåŠŸ), rejected(å¤±è´¥)</li> <li>Promise ä» pending å˜ä¸º fulfilled è¿‡ç¨‹æ˜¯æˆåŠŸçš„è¿‡ç¨‹å¯ä»¥æ‰§è¡Œå›è°ƒå‡½æ•° resolve()</li> <li>Promise ä» pending å˜ä¸º rejected è¿‡ç¨‹æ˜¯å¤±è´¥çš„è¿‡ç¨‹å¯ä»¥æ‰§è¡Œå›è°ƒå‡½æ•° reject()</li> <li>Promise çŠ¶æ€æ— æ³•ä¸­é€”å–æ¶ˆï¼Œä¸€æ—¦å»ºç«‹ç«‹å³æ‰§è¡Œï¼Œä¼šä¸€ç›´ä¿æŒè¿™ä¸ªç»“æœï¼Œè¿™æ—¶ä¹Ÿå« resolved(å·²å®šå‹çŠ¶æ€)</li> <li>Promise çŠ¶æ€æ”¹å˜æ—¶ then æ–¹æ³•æ”¯æŒå¤šæ¬¡é“¾å¼è°ƒç”¨</li> <li>Promise å¦‚æœä¸è®¾ç½®å›è°ƒå‡½æ•°å†…éƒ¨ä¼šæŠ›å¼‚å¸¸</li></ul></blockquote> <h2 id="_13-å®šä¹‰æ„é€ å‡½æ•°"><a href="#_13-å®šä¹‰æ„é€ å‡½æ•°" aria-hidden="true" class="header-anchor">#</a> 13 å®šä¹‰æ„é€ å‡½æ•°</h2> <div class="language- extra-class"><pre class="language-text"><code>/** * å°è£…åˆ¤æ–­å‚æ•°æ˜¯å¤Ÿæ˜¯å‡½æ•° */ 
function isFunction (fn) {
  return Object.prototype.toString.call(fn) === '[object Function]'
}
/** * å®šä¹‰æ„é€ å‡½æ•° * @param {*} fn */ 
function Promise(fn) {
  if (!isFunction(fn)) {
    throw new Error('Promise must accept a function as a parameter')
  }
}
</code></pre></div><h1 id="promise-å®ç°"><a href="#promise-å®ç°" aria-hidden="true" class="header-anchor">#</a> <a href="https://juejin.im/post/5c233a8ee51d450d5a01b712" target="_blank" rel="noopener noreferrer">promise å®ç°<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h1> <h1 id="æ€§æ„Ÿçš„promise"><a href="#æ€§æ„Ÿçš„promise" aria-hidden="true" class="header-anchor">#</a> <a href="https://juejin.im/post/5ab20c58f265da23a228fe0f" target="_blank" rel="noopener noreferrer">æ€§æ„Ÿçš„Promise<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h1> <h2 id="promise-ç‰¹æ€§"><a href="#promise-ç‰¹æ€§" aria-hidden="true" class="header-anchor">#</a> Promise ç‰¹æ€§</h2> <h3 id="promiseæ•è·é”™è¯¯ä¸-try-catch-ç­‰åŒ"><a href="#promiseæ•è·é”™è¯¯ä¸-try-catch-ç­‰åŒ" aria-hidden="true" class="header-anchor">#</a> Promiseæ•è·é”™è¯¯ä¸ try catch ç­‰åŒ</h3> <div class="language- extra-class"><pre class="language-text"><code>1.è¯·å†™å‡ºä¸‹åˆ—ä»£ç çš„è¾“å‡º
var p1 = new Promise(function(resolve, reject) {
    throw Error('sync error')
})
    .then(res =&gt; {
        console.log(res)
    })
    .catch(err =&gt; {
        console.log(1111)
        console.log(err)
    })

2.è¯·å†™å‡ºä¸‹åˆ—ä»£ç çš„è¾“å‡º
var p1 = new Promise(function(resolve, reject) {
    setTimeout(() =&gt; {
        throw Error('async error')   
    })
})
    .then(res =&gt; {
        console.log(res)
    })
    .catch(err =&gt; {
        console.log(err)
    })

3.è¯·å†™å‡ºä¸‹åˆ—ä»£ç çš„è¾“å‡º
var p1 = new Promise(function(resolve, reject) {
    resolve()
})
    .then(res =&gt; {
        throw Error('sync error') 
    })
å¤åˆ¶ä»£ç é”™è¯¯ä¸‰è¿ï¼Œä½ çŸ¥é“æ­£ç¡®ç­”æ¡ˆå—ğŸ˜ï¼Ÿ
æ­£ç¡®ç­”æ¡ˆæ˜¯ï¼š

Errorè¢«catchåˆ°ï¼Œæœ€åconsole.logè¾“å‡º
é”™è¯¯æ— æ³•è¢«catchï¼Œæ§åˆ¶å°æŠ¥é”™
promiseæ²¡æœ‰catchï¼Œé”™è¯¯è¢«æ•è·ååˆè¢«æŠ›å‡ºï¼Œæ§åˆ¶å°æŠ¥é”™
</code></pre></div><h3 id="è¿™é‡Œè€ƒæŸ¥çš„ä¸»è¦æ˜¯promiseçš„é”™è¯¯æ•è·ï¼Œå…¶å®ä»”ç»†æƒ³æƒ³jsä¸­èƒ½ç”¨çš„é”™è¯¯æ•è·ä¹Ÿåªèƒ½æ˜¯try-catchäº†ï¼Œè€Œtry-catchåªèƒ½æ•è·åŒæ­¥é”™è¯¯ï¼Œå¹¶ä¸”åœ¨æ²¡æœ‰ä¼ å…¥é”™è¯¯ç›‘å¬çš„æ—¶å€™ä¼šå°†æ•è·åˆ°çš„é”™è¯¯æŠ›å‡ºã€‚"><a href="#è¿™é‡Œè€ƒæŸ¥çš„ä¸»è¦æ˜¯promiseçš„é”™è¯¯æ•è·ï¼Œå…¶å®ä»”ç»†æƒ³æƒ³jsä¸­èƒ½ç”¨çš„é”™è¯¯æ•è·ä¹Ÿåªèƒ½æ˜¯try-catchäº†ï¼Œè€Œtry-catchåªèƒ½æ•è·åŒæ­¥é”™è¯¯ï¼Œå¹¶ä¸”åœ¨æ²¡æœ‰ä¼ å…¥é”™è¯¯ç›‘å¬çš„æ—¶å€™ä¼šå°†æ•è·åˆ°çš„é”™è¯¯æŠ›å‡ºã€‚" aria-hidden="true" class="header-anchor">#</a> è¿™é‡Œè€ƒæŸ¥çš„ä¸»è¦æ˜¯Promiseçš„é”™è¯¯æ•è·ï¼Œå…¶å®ä»”ç»†æƒ³æƒ³jsä¸­èƒ½ç”¨çš„é”™è¯¯æ•è·ä¹Ÿåªèƒ½æ˜¯try catchäº†ï¼Œè€Œ<strong>try catchåªèƒ½æ•è·åŒæ­¥é”™è¯¯</strong>ï¼Œå¹¶ä¸”åœ¨æ²¡æœ‰ä¼ å…¥é”™è¯¯ç›‘å¬çš„æ—¶å€™ä¼šå°†æ•è·åˆ°çš„é”™è¯¯æŠ›å‡ºã€‚</h3> <h2 id="å®ç°resolveã€rejectæ–¹æ³•ï¼Œthenæ–¹æ³•å’ŒçŠ¶æ€æœºåˆ¶"><a href="#å®ç°resolveã€rejectæ–¹æ³•ï¼Œthenæ–¹æ³•å’ŒçŠ¶æ€æœºåˆ¶" aria-hidden="true" class="header-anchor">#</a> å®ç°resolveã€rejectæ–¹æ³•ï¼Œthenæ–¹æ³•å’ŒçŠ¶æ€æœºåˆ¶</h2> <h3 id="æ ¹æ®ä½¿ç”¨æ–¹æ³•æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œpromiseæ˜¯ä¸€ä¸ªéœ€è¦æ¥å—ä¸€ä¸ªæ‰§è¡Œå™¨çš„æ„é€ å‡½æ•°ï¼Œæ‰§è¡Œå™¨æä¾›ä¸¤ä¸ªæ–¹æ³•ï¼Œå†…éƒ¨æœ‰çŠ¶æ€æœºåˆ¶ï¼ŒåŸå‹é“¾ä¸Šæœ‰thenæ–¹æ³•ã€‚"><a href="#æ ¹æ®ä½¿ç”¨æ–¹æ³•æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œpromiseæ˜¯ä¸€ä¸ªéœ€è¦æ¥å—ä¸€ä¸ªæ‰§è¡Œå™¨çš„æ„é€ å‡½æ•°ï¼Œæ‰§è¡Œå™¨æä¾›ä¸¤ä¸ªæ–¹æ³•ï¼Œå†…éƒ¨æœ‰çŠ¶æ€æœºåˆ¶ï¼ŒåŸå‹é“¾ä¸Šæœ‰thenæ–¹æ³•ã€‚" aria-hidden="true" class="header-anchor">#</a> æ ¹æ®ä½¿ç”¨æ–¹æ³•æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼ŒPromiseæ˜¯ä¸€ä¸ªéœ€è¦æ¥å—ä¸€ä¸ªæ‰§è¡Œå™¨çš„æ„é€ å‡½æ•°ï¼Œæ‰§è¡Œå™¨æä¾›ä¸¤ä¸ªæ–¹æ³•ï¼Œå†…éƒ¨æœ‰çŠ¶æ€æœºåˆ¶ï¼ŒåŸå‹é“¾ä¸Šæœ‰thenæ–¹æ³•ã€‚</h3> <div class="language- extra-class"><pre class="language-text"><code>å¼€å§‹æ’¸ï¼š
// myPromise
function Promise(executor){ //executoræ˜¯ä¸€ä¸ªæ‰§è¡Œå™¨ï¼ˆå‡½æ•°ï¼‰
    let _this = this // å…ˆç¼“å­˜thisä»¥å…åé¢æŒ‡é’ˆæ··ä¹±
    _this.status = 'pending' // é»˜è®¤çŠ¶æ€ä¸ºç­‰å¾…æ€
    _this.value = undefined // æˆåŠŸæ—¶è¦ä¼ é€’ç»™æˆåŠŸå›è°ƒçš„æ•°æ®ï¼Œé»˜è®¤undefined
    _this.reason = undefined // å¤±è´¥æ—¶è¦ä¼ é€’ç»™å¤±è´¥å›è°ƒçš„åŸå› ï¼Œé»˜è®¤undefined

    function resolve(value) { // å†…ç½®ä¸€ä¸ªresolveæ–¹æ³•ï¼Œæ¥æ”¶æˆåŠŸçŠ¶æ€æ•°æ®
        // ä¸Šé¢è¯´äº†ï¼Œåªæœ‰pendingå¯ä»¥è½¬ä¸ºå…¶ä»–çŠ¶æ€ï¼Œæ‰€ä»¥è¿™é‡Œè¦åˆ¤æ–­ä¸€ä¸‹
        if (_this.status === 'pending') { 
            _this.status = 'resolved' // å½“è°ƒç”¨resolveæ—¶è¦å°†çŠ¶æ€æ”¹ä¸ºæˆåŠŸæ€
            _this.value = value // ä¿å­˜æˆåŠŸæ—¶ä¼ è¿›æ¥çš„æ•°æ®
        }
    }
    function reject(reason) { // å†…ç½®ä¸€ä¸ªrejectæ–¹æ³•ï¼Œå¤±è´¥çŠ¶æ€æ—¶æ¥æ”¶åŸå› 
        if (_this.status === 'pending') { // å’ŒresolveåŒç†
            _this.status = 'rejected' // è½¬ä¸ºå¤±è´¥æ€
            _this.reason = reason // ä¿å­˜å¤±è´¥åŸå› 
        }
    }
    executor(resolve, reject) // æ‰§è¡Œæ‰§è¡Œå™¨å‡½æ•°ï¼Œå¹¶å°†ä¸¤ä¸ªæ–¹æ³•ä¼ å…¥
}
// thenæ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯æˆåŠŸå’Œå¤±è´¥çš„å›è°ƒï¼Œè¿™é‡Œæˆ‘ä»¬å‘½åä¸ºonFulfilledå’ŒonRjected
Promise.prototype.then = function(onFulfilled, onRjected){
    let _this = this;   // ä¾ç„¶ç¼“å­˜this
    if(_this.status === 'resolved'){  // åˆ¤æ–­å½“å‰Promiseçš„çŠ¶æ€
        onFulfilled(_this.value)  // å¦‚æœæ˜¯æˆåŠŸæ€ï¼Œå½“ç„¶æ˜¯è¦æ‰§è¡Œç”¨æˆ·ä¼ é€’çš„æˆåŠŸå›è°ƒï¼Œå¹¶æŠŠæ•°æ®ä¼ è¿›å»
    }
    if(_this.status === 'rejected'){ // åŒç†
        onRjected(_this.reason)
    }
}
module.exports = Promise  // å¯¼å‡ºæ¨¡å—ï¼Œå¦åˆ™åˆ«çš„æ–‡ä»¶æ²¡æ³•ä½¿ç”¨
</code></pre></div><h3 id="æ³¨æ„ï¼šä¸Šé¢ä»£ç çš„å‘½åä¸æ˜¯éšä¾¿èµ·çš„ï¼Œåƒonfulfilledå’Œonrjectedï¼Œæ˜¯ä¸¥æ ¼æŒ‰ç…§promise-a-è§„èŒƒèµ°çš„"><a href="#æ³¨æ„ï¼šä¸Šé¢ä»£ç çš„å‘½åä¸æ˜¯éšä¾¿èµ·çš„ï¼Œåƒonfulfilledå’Œonrjectedï¼Œæ˜¯ä¸¥æ ¼æŒ‰ç…§promise-a-è§„èŒƒèµ°çš„" aria-hidden="true" class="header-anchor">#</a> æ³¨æ„ï¼šä¸Šé¢ä»£ç çš„å‘½åä¸æ˜¯éšä¾¿èµ·çš„ï¼ŒåƒonFulfilledå’ŒonRjectedï¼Œæ˜¯ä¸¥æ ¼æŒ‰ç…§Promise/A+è§„èŒƒèµ°çš„</h3> <h3 id="è¿™æ ·æˆ‘ä»¬å°±å®ç°äº†ç¬¬ä¸€æ­¥ï¼Œå¯ä»¥åˆ›å»ºpromiseå®ä¾‹å¹¶ä½¿ç”¨thenæ–¹æ³•äº†ï¼Œæµ‹è¯•ä¸€ä¸‹"><a href="#è¿™æ ·æˆ‘ä»¬å°±å®ç°äº†ç¬¬ä¸€æ­¥ï¼Œå¯ä»¥åˆ›å»ºpromiseå®ä¾‹å¹¶ä½¿ç”¨thenæ–¹æ³•äº†ï¼Œæµ‹è¯•ä¸€ä¸‹" aria-hidden="true" class="header-anchor">#</a> è¿™æ ·æˆ‘ä»¬å°±å®ç°äº†ç¬¬ä¸€æ­¥ï¼Œå¯ä»¥åˆ›å»ºPromiseå®ä¾‹å¹¶ä½¿ç”¨thenæ–¹æ³•äº†ï¼Œæµ‹è¯•ä¸€ä¸‹</h3> <div class="language- extra-class"><pre class="language-text"><code>let Promise = require('./myPromise')  // å¼•å…¥æ¨¡å—
let p = new Promise(function(resolve, reject){
  resolve('test')
})
p.then(function(data){
  console.log('æˆåŠŸ', data)
},function(err){
  console.log('å¤±è´¥', err)
})
// æˆåŠŸ test

å†è¯•è¯•reject
let Promise = require('./myPromise')  // å¼•å…¥æ¨¡å—
let p = new Promise(function(resolve, reject){
  reject('test')
})
p.then(function(data){
  console.log('æˆåŠŸ', data)
},function(err){
  console.log('å¤±è´¥', err)
})
// å¤±è´¥ test
</code></pre></div><h3 id="çœ‹èµ·æ¥ä¸é”™ï¼Œä½†å›è°ƒå‡½æ•°æ˜¯ç«‹å³æ‰§è¡Œçš„ï¼Œæ— æ³•è¿›è¡Œå¼‚æ­¥æ“ä½œï¼Œæ¯”å¦‚è¿™æ ·æ˜¯ä¸è¡Œçš„"><a href="#çœ‹èµ·æ¥ä¸é”™ï¼Œä½†å›è°ƒå‡½æ•°æ˜¯ç«‹å³æ‰§è¡Œçš„ï¼Œæ— æ³•è¿›è¡Œå¼‚æ­¥æ“ä½œï¼Œæ¯”å¦‚è¿™æ ·æ˜¯ä¸è¡Œçš„" aria-hidden="true" class="header-anchor">#</a> çœ‹èµ·æ¥ä¸é”™ï¼Œä½†å›è°ƒå‡½æ•°æ˜¯ç«‹å³æ‰§è¡Œçš„ï¼Œæ— æ³•è¿›è¡Œå¼‚æ­¥æ“ä½œï¼Œæ¯”å¦‚è¿™æ ·æ˜¯ä¸è¡Œçš„</h3> <div class="language- extra-class"><pre class="language-text"><code>let p = new Promise(function(resolve, reject){
  setTimeout(function(){
    resolve(100)  
  }, 1000)
})
p.then(function(data){
  console.log('æˆåŠŸ', data)
},function(err){
  console.log('å¤±è´¥', err)
})
// ä¸ä¼šè¾“å‡ºä»»ä½•ä»£ç 
</code></pre></div><p>åŸå› æ˜¯æˆ‘ä»¬åœ¨thenå‡½æ•°ä¸­åªå¯¹æˆåŠŸæ€å’Œå¤±è´¥æ€è¿›è¡Œäº†åˆ¤æ–­ï¼Œè€Œå®ä¾‹è¢«newæ—¶ï¼Œæ‰§è¡Œå™¨ä¸­çš„ä»£ç ä¼šç«‹å³æ‰§è¡Œï¼Œä½†setTimeoutä¸­çš„ä»£ç å°†ç¨åæ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œthenæ–¹æ³•æ‰§è¡Œæ—¶ï¼ŒPromiseçš„çŠ¶æ€æ²¡æœ‰è¢«æ”¹å˜ä¾ç„¶æ˜¯pendingæ€ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å¯¹pendingæ€ä¹Ÿåšåˆ¤æ–­ï¼Œè€Œç”±äºä»£ç å¯èƒ½æ˜¯å¼‚æ­¥çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¦æƒ³åŠæ³•æŠŠå›è°ƒå‡½æ•°è¿›è¡Œç¼“å­˜ï¼Œå¹¶ä¸”ï¼Œ<strong>thenæ–¹æ³•æ˜¯å¯ä»¥å¤šæ¬¡ä½¿ç”¨çš„</strong>ï¼Œæ‰€ä»¥è¦èƒ½å­˜å¤šä¸ªå›è°ƒï¼Œé‚£ä¹ˆè¿™é‡Œæˆ‘ä»¬ç”¨ä¸€ä¸ªæ•°ç»„ã€‚</p> <h2 id="å®ç°å¼‚æ­¥"><a href="#å®ç°å¼‚æ­¥" aria-hidden="true" class="header-anchor">#</a> å®ç°å¼‚æ­¥</h2> <div class="language- extra-class"><pre class="language-text"><code>åœ¨å®ä¾‹ä¸ŠæŒ‚ä¸¤ä¸ªå‚æ•°
_this.onResolvedCallbacks = []; // å­˜æ”¾thenæˆåŠŸçš„å›è°ƒ
_this.onRejectedCallbacks = []; // å­˜æ”¾thenå¤±è´¥çš„å›è°ƒ

thenæ–¹æ³•åŠ ä¸€ä¸ªpendingæ—¶çš„åˆ¤æ–­
if(_this.status === 'pending'){
    // æ¯ä¸€æ¬¡thenæ—¶ï¼Œå¦‚æœæ˜¯ç­‰å¾…æ€ï¼Œå°±æŠŠå›è°ƒå‡½æ•°pushè¿›æ•°ç»„ä¸­ï¼Œä»€ä¹ˆæ—¶å€™æ”¹å˜çŠ¶æ€ä»€ä¹ˆæ—¶å€™å†æ‰§è¡Œ
    _this.onResolvedCallbacks.push(function(){ // è¿™é‡Œç”¨ä¸€ä¸ªå‡½æ•°åŒ…èµ·æ¥ï¼Œæ˜¯ä¸ºäº†åé¢åŠ å…¥æ–°çš„é€»è¾‘è¿›å»
        onFulfilled(_this.value)
    })
    _this.onRejectedCallbacks.push(function(){ // åŒç†
        onRjected(_this.reason)
    })
}
</code></pre></div><h3 id="ä¸‹ä¸€æ­¥è¦åˆ†åˆ«åœ¨resolveå’Œrejectæ–¹æ³•é‡ŒåŠ å…¥æ‰§è¡Œæ•°ç»„ä¸­å­˜æ”¾çš„å‡½æ•°çš„æ–¹æ³•ï¼Œä¿®æ”¹ä¸€ä¸‹ä¸Šé¢çš„resolveå’Œrejectæ–¹æ³•"><a href="#ä¸‹ä¸€æ­¥è¦åˆ†åˆ«åœ¨resolveå’Œrejectæ–¹æ³•é‡ŒåŠ å…¥æ‰§è¡Œæ•°ç»„ä¸­å­˜æ”¾çš„å‡½æ•°çš„æ–¹æ³•ï¼Œä¿®æ”¹ä¸€ä¸‹ä¸Šé¢çš„resolveå’Œrejectæ–¹æ³•" aria-hidden="true" class="header-anchor">#</a> ä¸‹ä¸€æ­¥è¦åˆ†åˆ«åœ¨resolveå’Œrejectæ–¹æ³•é‡ŒåŠ å…¥æ‰§è¡Œæ•°ç»„ä¸­å­˜æ”¾çš„å‡½æ•°çš„æ–¹æ³•ï¼Œä¿®æ”¹ä¸€ä¸‹ä¸Šé¢çš„resolveå’Œrejectæ–¹æ³•</h3> <div class="language- extra-class"><pre class="language-text"><code>function resolve(value) {
    if (_this.status === 'pending') { 
        _this.status = 'resolved'
        _this.value = value
        _this.onResolvedCallbacks.forEach(function(fn){ // å½“æˆåŠŸçš„å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œä¹‹å‰ç¼“å­˜çš„å›è°ƒå‡½æ•°ä¼šè¢«ä¸€ä¸€è°ƒç”¨
            fn()
        })
    }
}
function reject(reason) {
    if (_this.status === 'pending') {
        _this.status = 'rejected'
        _this.reason = reason
        _this.onRejectedCallbacks.forEach(function(fn){// å½“å¤±è´¥çš„å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œä¹‹å‰ç¼“å­˜çš„å›è°ƒå‡½æ•°ä¼šè¢«ä¸€ä¸€è°ƒç”¨
            fn()
        })
    }
}
</code></pre></div><img src="https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1553512864607&amp;di=5b491e10e97890200d59683f2af90f29&amp;imgtype=0&amp;src=http%3A%2F%2Fstatic.rong360.com%2Fgl%2Fuploads%2Fallimg%2F150907%2F1919395621-5.jpg" width="30%"> <h3 id="ç°åœ¨å¯ä»¥æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡äº†ï¼Œä¹Ÿå¯ä»¥å¤šæ¬¡thenäº†ï¼Œä¸€ä¸ªç©·äººç‰ˆpromiseå°±å®Œæˆäº†"><a href="#ç°åœ¨å¯ä»¥æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡äº†ï¼Œä¹Ÿå¯ä»¥å¤šæ¬¡thenäº†ï¼Œä¸€ä¸ªç©·äººç‰ˆpromiseå°±å®Œæˆäº†" aria-hidden="true" class="header-anchor">#</a> ç°åœ¨å¯ä»¥æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡äº†ï¼Œä¹Ÿå¯ä»¥å¤šæ¬¡thenäº†ï¼Œä¸€ä¸ªç©·äººç‰ˆPromiseå°±å®Œæˆäº†</h3> <h2 id="å¤„ç†é”™è¯¯"><a href="#å¤„ç†é”™è¯¯" aria-hidden="true" class="header-anchor">#</a> å¤„ç†é”™è¯¯</h2> <div class="language- extra-class"><pre class="language-text"><code>çœŸæ­£çš„Promiseå¦‚æœåœ¨å®ä¾‹ä¸­æŠ›å‡ºé”™è¯¯ï¼Œåº”è¯¥èµ°reject:

new Promise(function(resolve, reject){
  throw new Error('é”™è¯¯')
}).then(function(){
    
},function(err){
  console.log('é”™è¯¯:', err)  
})
// é”™è¯¯: Error: é”™è¯¯

æˆ‘ä»¬å®ç°ä¸€ä¸‹ï¼Œæ€è·¯å¾ˆç®€å•ï¼Œåœ¨æ‰§è¡Œå™¨æ‰§è¡Œæ—¶è¿›è¡Œtry catch

try{
    executor(resolve, reject)        
}catch(e){ // å¦‚æœæ•è·å‘ç”Ÿå¼‚å¸¸ï¼Œç›´æ¥è°ƒå¤±è´¥ï¼Œå¹¶æŠŠå‚æ•°ç©¿è¿›å»
    reject(e)
}
</code></pre></div><h2 id="å®ç°thençš„é“¾å¼è°ƒç”¨ï¼ˆéš¾ç‚¹ï¼‰promiseçš„thenæ–¹æ³•å®ç°é“¾å¼è°ƒç”¨çš„åŸç†æ˜¯ï¼šè¿”å›ä¸€ä¸ªæ–°çš„promise"><a href="#å®ç°thençš„é“¾å¼è°ƒç”¨ï¼ˆéš¾ç‚¹ï¼‰promiseçš„thenæ–¹æ³•å®ç°é“¾å¼è°ƒç”¨çš„åŸç†æ˜¯ï¼šè¿”å›ä¸€ä¸ªæ–°çš„promise" aria-hidden="true" class="header-anchor">#</a> å®ç°thençš„é“¾å¼è°ƒç”¨ï¼ˆéš¾ç‚¹ï¼‰Promiseçš„thenæ–¹æ³•å®ç°é“¾å¼è°ƒç”¨çš„åŸç†æ˜¯ï¼šè¿”å›ä¸€ä¸ªæ–°çš„Promise</h2> <h3 id="åœ¨thenæ–¹æ³•ä¸­å…ˆå®šä¹‰ä¸€ä¸ªæ–°çš„promiseï¼Œå–åä¸ºpromise2ï¼ˆå®˜æ–¹è§„å®šçš„ï¼‰ï¼Œç„¶ååœ¨ä¸‰ç§çŠ¶æ€ä¸‹åˆ†åˆ«ç”¨promise2åŒ…è£…ä¸€ä¸‹ï¼Œåœ¨è°ƒç”¨onfulfilledæ—¶ç”¨ä¸€ä¸ªå˜é‡xï¼ˆè§„å®šçš„ï¼‰æ¥æ”¶è¿”å›å€¼ï¼Œtrycatchä¸€ä¸‹ä»£ç ï¼Œæ²¡é”™å°±è°ƒresolveä¼ å…¥xï¼Œæœ‰é”™å°±è°ƒrejectä¼ å…¥é”™è¯¯ï¼Œæœ€åå†æŠŠpromise2ç»™returnå‡ºå»ï¼Œå°±å¯ä»¥è¿›è¡Œé“¾å¼è°ƒç”¨äº†ï¼Œï¼Œï¼Œï¼Œä½†æ˜¯ï¼"><a href="#åœ¨thenæ–¹æ³•ä¸­å…ˆå®šä¹‰ä¸€ä¸ªæ–°çš„promiseï¼Œå–åä¸ºpromise2ï¼ˆå®˜æ–¹è§„å®šçš„ï¼‰ï¼Œç„¶ååœ¨ä¸‰ç§çŠ¶æ€ä¸‹åˆ†åˆ«ç”¨promise2åŒ…è£…ä¸€ä¸‹ï¼Œåœ¨è°ƒç”¨onfulfilledæ—¶ç”¨ä¸€ä¸ªå˜é‡xï¼ˆè§„å®šçš„ï¼‰æ¥æ”¶è¿”å›å€¼ï¼Œtrycatchä¸€ä¸‹ä»£ç ï¼Œæ²¡é”™å°±è°ƒresolveä¼ å…¥xï¼Œæœ‰é”™å°±è°ƒrejectä¼ å…¥é”™è¯¯ï¼Œæœ€åå†æŠŠpromise2ç»™returnå‡ºå»ï¼Œå°±å¯ä»¥è¿›è¡Œé“¾å¼è°ƒç”¨äº†ï¼Œï¼Œï¼Œï¼Œä½†æ˜¯ï¼" aria-hidden="true" class="header-anchor">#</a> åœ¨thenæ–¹æ³•ä¸­å…ˆå®šä¹‰ä¸€ä¸ªæ–°çš„Promiseï¼Œå–åä¸ºpromise2ï¼ˆå®˜æ–¹è§„å®šçš„ï¼‰ï¼Œç„¶ååœ¨ä¸‰ç§çŠ¶æ€ä¸‹åˆ†åˆ«ç”¨promise2åŒ…è£…ä¸€ä¸‹ï¼Œåœ¨è°ƒç”¨onFulfilledæ—¶ç”¨ä¸€ä¸ªå˜é‡xï¼ˆè§„å®šçš„ï¼‰æ¥æ”¶è¿”å›å€¼ï¼Œtrycatchä¸€ä¸‹ä»£ç ï¼Œæ²¡é”™å°±è°ƒresolveä¼ å…¥xï¼Œæœ‰é”™å°±è°ƒrejectä¼ å…¥é”™è¯¯ï¼Œæœ€åå†æŠŠpromise2ç»™returnå‡ºå»ï¼Œå°±å¯ä»¥è¿›è¡Œé“¾å¼è°ƒç”¨äº†ï¼Œï¼Œï¼Œï¼Œä½†æ˜¯ï¼</h3> <div class="language- extra-class"><pre class="language-text"><code>// æ”¹åŠ¨then
let promise2;
if (_this.status === 'resolved') {
    promise2 = new Promise(function (resolve, reject) {
        // å¯ä»¥å‡‘åˆç”¨ï¼Œä½†æ˜¯æ˜¯æœ‰å¾ˆå¤šé—®é¢˜çš„
        try { 
            let x = onFulfilled(_this.value)
            resolve(x)
        } catch (e) {
            reject(e)
        }
    })
}
if (_this.status === 'rejected') {
    promise2 = new Promise(function (resolve, reject) {
        // å¯ä»¥å‡‘åˆç”¨ï¼Œä½†æ˜¯æ˜¯æœ‰å¾ˆå¤šé—®é¢˜çš„
        try {
            let x = onRjected(_this.reason)
            resolve(x)
        } catch (e) {
            reject(e)
        }
    })
}
if(_this.status === 'pending'){
    promise2 = new Promise(function (resolve, rejec
        _this.onResolvedCallbacks.push(function(){
             // å¯ä»¥å‡‘åˆç”¨ï¼Œä½†æ˜¯æ˜¯æœ‰å¾ˆå¤šé—®é¢˜çš„
            try {
                let x = onFulfilled(_this.value)
                resolve(x)
            } catch (e) {
                reject(e)
            }
        })
        _this.onRejectedCallbacks.push(function(){
             // å¯ä»¥å‡‘åˆç”¨ï¼Œä½†æ˜¯æ˜¯æœ‰å¾ˆå¤šé—®é¢˜çš„
            try {
                let x = onRjected(_this.reason)
                resolve(x)
            } catch (e) {
                reject(e)
            }
        })
    })
}
return promise2

è¿™é‡Œæˆ‘å…ˆè§£é‡Šä¸€ä¸‹xçš„ä½œç”¨å†è¯´ä¸ºä»€ä¹ˆä¸è¡Œï¼Œxæ˜¯ç”¨æ¥æ¥æ”¶ä¸Šä¸€æ¬¡thençš„è¿”å›å€¼ï¼Œæ¯”å¦‚è¿™æ ·
let p = new Promise(function(resolve, reject){
  resolve(data)  
})
p.then(function(data){
    return xxx // è¿™é‡Œè¿”å›ä¸€ä¸ªå€¼
}, function(){
    
}).then(function(data){
    console.log // è¿™é‡Œä¼šæ¥æ”¶åˆ°xxx
}, function(){
    
})
// ä»¥ä¸Šä»£ç ä¸­ç¬¬ä¸€æ¬¡thençš„è¿”å›å€¼å°±æ˜¯æºç å†…ç¬¬ä¸€æ¬¡è°ƒç”¨onRjectedçš„è¿”å›å€¼ï¼Œå¯ä»¥ç”¨ä¸€ä¸ªxæ¥æ¥æ”¶

</code></pre></div><img src="https://ss2.bdstatic.com/70cFvnSh_Q1YnxGkpoWK1HF6hhy/it/u=1427013723,1115906159&amp;fm=26&amp;gp=0.jpg" width="30%"> <h2 id="æœªå®Œå¾…ç»­"><a href="#æœªå®Œå¾…ç»­" aria-hidden="true" class="header-anchor">#</a> æœªå®Œå¾…ç»­</h2> <h1 id="promiseå¿…ä¼šé¢˜"><a href="#promiseå¿…ä¼šé¢˜" aria-hidden="true" class="header-anchor">#</a> Promiseå¿…ä¼šé¢˜</h1> <img src="https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1553515665489&amp;di=f7541c3820b50d04456ca0982cba8d4d&amp;imgtype=0&amp;src=http%3A%2F%2Fdingyue.ws.126.net%2FsTe19%3DcqsGHF9FqtEEe6hbZzNRnwvAxzvbmXzhIHGpxie1551763702238.jpg" width="30%"> <h2 id="async-æ˜¯ä¸€ç§è¯­æ³•ï¼Œpromise-æ˜¯ä¸€ä¸ªå†…ç½®å¯¹è±¡ï¼Œä¸¤è€…å¹¶ä¸å…·å¤‡å¯æ¯”æ€§"><a href="#async-æ˜¯ä¸€ç§è¯­æ³•ï¼Œpromise-æ˜¯ä¸€ä¸ªå†…ç½®å¯¹è±¡ï¼Œä¸¤è€…å¹¶ä¸å…·å¤‡å¯æ¯”æ€§" aria-hidden="true" class="header-anchor">#</a> async æ˜¯ä¸€ç§è¯­æ³•ï¼ŒPromise æ˜¯ä¸€ä¸ªå†…ç½®å¯¹è±¡ï¼Œä¸¤è€…å¹¶ä¸å…·å¤‡å¯æ¯”æ€§</h2> <p>æ›´ä½•å†µ async å‡½æ•°ä¹Ÿè¿”å›ä¸€ä¸ª Promise å¯¹è±¡â€¦â€¦</p> <p>ä½¿ç”¨ async ä¼šæ¯”ä½¿ç”¨ Promise æ›´ä¼˜é›…çš„å¤„ç†å¼‚æ­¥æµç¨‹ã€‚</p> <ol><li>ä»£ç æ›´åŠ ç®€æ´</li> <li>é”™è¯¯å¤„ç†
async function fetch() {
try {
const data = JSON.parse(await fetchData())
} catch (err) {
console.log(err)
}
};</li> <li>è°ƒè¯•
ç”¨ async çš„æ—¶å€™ï¼Œåˆ™å¯ä»¥åƒè°ƒè¯•åŒæ­¥ä»£ç ä¸€æ ·è°ƒè¯•ã€‚</li></ol> <h1 id="async-awaitå’Œpromiseçš„å…³ç³»"><a href="#async-awaitå’Œpromiseçš„å…³ç³»" aria-hidden="true" class="header-anchor">#</a> async-awaitå’ŒPromiseçš„å…³ç³»</h1> <h2 id="async-await-æ˜¯å»ºç«‹åœ¨-promiseæœºåˆ¶ä¹‹ä¸Šçš„ï¼Œå¹¶ä¸èƒ½å–ä»£å…¶åœ°ä½ã€‚"><a href="#async-await-æ˜¯å»ºç«‹åœ¨-promiseæœºåˆ¶ä¹‹ä¸Šçš„ï¼Œå¹¶ä¸èƒ½å–ä»£å…¶åœ°ä½ã€‚" aria-hidden="true" class="header-anchor">#</a> async-await æ˜¯å»ºç«‹åœ¨ promiseæœºåˆ¶ä¹‹ä¸Šçš„ï¼Œå¹¶ä¸èƒ½å–ä»£å…¶åœ°ä½ã€‚</h2> <h2 id="asyncç”¨æ¥è¡¨ç¤ºå‡½æ•°æ˜¯å¼‚æ­¥çš„ï¼Œå®šä¹‰çš„å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªpromiseå¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨thenæ–¹æ³•æ·»åŠ å›è°ƒå‡½æ•°ã€‚"><a href="#asyncç”¨æ¥è¡¨ç¤ºå‡½æ•°æ˜¯å¼‚æ­¥çš„ï¼Œå®šä¹‰çš„å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªpromiseå¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨thenæ–¹æ³•æ·»åŠ å›è°ƒå‡½æ•°ã€‚" aria-hidden="true" class="header-anchor">#</a> asyncç”¨æ¥è¡¨ç¤ºå‡½æ•°æ˜¯å¼‚æ­¥çš„ï¼Œå®šä¹‰çš„å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªpromiseå¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨thenæ–¹æ³•æ·»åŠ å›è°ƒå‡½æ•°ã€‚</h2> <div class="language- extra-class"><pre class="language-text"><code>async function demo01() {
    return 123;
}

demo01().then(val =&gt; {
    console.log(val);// 123
});
è‹¥ async å®šä¹‰çš„å‡½æ•°æœ‰è¿”å›å€¼ï¼Œreturn 123;ç›¸å½“äºPromise.resolve(123),æ²¡æœ‰å£°æ˜å¼çš„ returnåˆ™ç›¸å½“äºæ‰§è¡Œäº†Promise.resolve();
</code></pre></div><h2 id="await-å¯ä»¥ç†è§£ä¸ºæ˜¯-async-wait-çš„ç®€å†™ã€‚await-å¿…é¡»å‡ºç°åœ¨-async-å‡½æ•°å†…éƒ¨ï¼Œä¸èƒ½å•ç‹¬ä½¿ç”¨ã€‚"><a href="#await-å¯ä»¥ç†è§£ä¸ºæ˜¯-async-wait-çš„ç®€å†™ã€‚await-å¿…é¡»å‡ºç°åœ¨-async-å‡½æ•°å†…éƒ¨ï¼Œä¸èƒ½å•ç‹¬ä½¿ç”¨ã€‚" aria-hidden="true" class="header-anchor">#</a> await å¯ä»¥ç†è§£ä¸ºæ˜¯ async wait çš„ç®€å†™ã€‚await å¿…é¡»å‡ºç°åœ¨ async å‡½æ•°å†…éƒ¨ï¼Œä¸èƒ½å•ç‹¬ä½¿ç”¨ã€‚</h2> <img src="http://pic.rmb.bdstatic.com/729689787df79599e77e4c85a42b22ea.jpeg" width="50%/"> <h2 id="awaitå¿…é¡»æ¥ä¸€ä¸ªpromiseå¯¹è±¡çš„å†³è®®"><a href="#awaitå¿…é¡»æ¥ä¸€ä¸ªpromiseå¯¹è±¡çš„å†³è®®" aria-hidden="true" class="header-anchor">#</a> awaitå¿…é¡»æ¥ä¸€ä¸ªpromiseå¯¹è±¡çš„å†³è®®</h2> <p>await åé¢å¯ä»¥è·Ÿä»»ä½•çš„JS è¡¨è¾¾å¼ã€‚è™½ç„¶è¯´ await å¯ä»¥ç­‰å¾ˆå¤šç±»å‹çš„ä¸œè¥¿ï¼Œä½†æ˜¯å®ƒæœ€ä¸»è¦çš„<strong>æ„å›¾</strong>æ˜¯ç”¨æ¥ç­‰å¾… Promise å¯¹è±¡çš„çŠ¶æ€è¢« resolvedã€‚<strong>å¦‚æœawaitçš„æ˜¯ promiseå¯¹è±¡</strong>ä¼šé€ æˆå¼‚æ­¥å‡½æ•°<strong>åœæ­¢æ‰§è¡Œå¹¶ä¸”ç­‰å¾… promise çš„å†³è®®</strong>,å¦‚æœç­‰çš„æ˜¯**æ­£å¸¸çš„è¡¨è¾¾å¼ï¼ˆé™¤äº†promiseå¯¹è±¡ï¼‰**åˆ™ç«‹å³æ‰§è¡Œã€‚<strong>ä¸åœ¨ç­‰å¾…ï¼Œå¤±å»æœ¬æ„</strong></p> <h2 id="ä½ æœ‰ä¸‰ä¸ªè¯·æ±‚éœ€è¦å‘ç”Ÿï¼Œç¬¬ä¸‰ä¸ªè¯·æ±‚æ˜¯ä¾èµ–äºç¬¬äºŒä¸ªè¯·æ±‚çš„è§£æ„ç¬¬äºŒä¸ªè¯·æ±‚ä¾èµ–äºç¬¬ä¸€ä¸ªè¯·æ±‚çš„ç»“æœã€‚ç”¨-f"><a href="#ä½ æœ‰ä¸‰ä¸ªè¯·æ±‚éœ€è¦å‘ç”Ÿï¼Œç¬¬ä¸‰ä¸ªè¯·æ±‚æ˜¯ä¾èµ–äºç¬¬äºŒä¸ªè¯·æ±‚çš„è§£æ„ç¬¬äºŒä¸ªè¯·æ±‚ä¾èµ–äºç¬¬ä¸€ä¸ªè¯·æ±‚çš„ç»“æœã€‚ç”¨-f" aria-hidden="true" class="header-anchor">#</a> ä½ æœ‰ä¸‰ä¸ªè¯·æ±‚éœ€è¦å‘ç”Ÿï¼Œç¬¬ä¸‰ä¸ªè¯·æ±‚æ˜¯ä¾èµ–äºç¬¬äºŒä¸ªè¯·æ±‚çš„è§£æ„ç¬¬äºŒä¸ªè¯·æ±‚ä¾èµ–äºç¬¬ä¸€ä¸ªè¯·æ±‚çš„ç»“æœã€‚ç”¨ f()</h2> <h2 id="æœ‰ä¸‰ä¸ªå¼‚æ­¥è¯·æ±‚éœ€è¦å‘é€ï¼Œç›¸äº’æ²¡æœ‰å…³è”ï¼Œåªæ˜¯éœ€è¦å½“è¯·æ±‚éƒ½ç»“æŸåå°†ç•Œé¢çš„-loading-æ¸…é™¤æ‰å³å¯ã€‚ç”¨-t"><a href="#æœ‰ä¸‰ä¸ªå¼‚æ­¥è¯·æ±‚éœ€è¦å‘é€ï¼Œç›¸äº’æ²¡æœ‰å…³è”ï¼Œåªæ˜¯éœ€è¦å½“è¯·æ±‚éƒ½ç»“æŸåå°†ç•Œé¢çš„-loading-æ¸…é™¤æ‰å³å¯ã€‚ç”¨-t" aria-hidden="true" class="header-anchor">#</a> æœ‰ä¸‰ä¸ªå¼‚æ­¥è¯·æ±‚éœ€è¦å‘é€ï¼Œç›¸äº’æ²¡æœ‰å…³è”ï¼Œåªæ˜¯éœ€è¦å½“è¯·æ±‚éƒ½ç»“æŸåå°†ç•Œé¢çš„ loading æ¸…é™¤æ‰å³å¯ã€‚ç”¨ t()</h2> <div class="language- extra-class"><pre class="language-text"><code>function tt () {
      return new Promise((resolve, reject) =&gt; {
        setTimeout(() =&gt; {
          console.log(1)
          resolve('tt')
        }, 2000)
      })
    }
    function ttt () {
      return new Promise((resolve, reject) =&gt; {
        setTimeout(() =&gt; {
          console.log(2)
          resolve('ttt')
        }, 2000)
      })
    }

    // ä¸€æ¬¡æ‰§è¡Œï¼Œä¾èµ–ä¸Šä¸€ä¸ªçš„ç»“æœæ¨¡å¼
    async function f () {
      let tt1 = await tt()
      let ttt1 = await ttt()
      console.log(tt1)
      console.log(ttt1)
    }
    // æ²¡æœ‰ä¾èµ–å…³ç³»ï¼Œåªå…³æ³¨éƒ½æ‰§è¡Œå®Œæ¯•çš„çŠ¶æ€
    async function t () {
      let tt1 = tt()
      let ttt1 = ttt()
      await Promise.all([tt1, ttt1])
    }

    f()
    t()
</code></pre></div><p><strong>async-awaitå¹¶ä¸èƒ½å–ä»£promise</strong></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">æœ‰å¿—è€…ï¼Œäº‹ç«æˆï¼›è‹¦å¿ƒäººï¼Œå¤©ä¸è´Ÿ: </span> <span class="time">10/29/2019, 4:04:54 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        â†
        <a href="/js/è¯­è¨€ç²¾é«“.html" class="prev">
          åŸå‹
        </a></span> <span class="next"><a href="/js/promiseæ€è·¯.html">
          æ‰‹å†™æ€è·¯
        </a>
        â†’
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.6ba358d5.js" defer></script><script src="/assets/js/2.ae98e73b.js" defer></script><script src="/assets/js/27.b5e919f8.js" defer></script>
  </body>
</html>
