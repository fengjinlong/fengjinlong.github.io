<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>bind | 个人博客</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/assets/css/0.styles.d9af7a00.css" as="style"><link rel="preload" href="/assets/js/app.6ba358d5.js" as="script"><link rel="preload" href="/assets/js/2.ae98e73b.js" as="script"><link rel="preload" href="/assets/js/22.b999c181.js" as="script"><link rel="prefetch" href="/assets/js/10.42ff595e.js"><link rel="prefetch" href="/assets/js/11.4ed22736.js"><link rel="prefetch" href="/assets/js/12.6a6a3966.js"><link rel="prefetch" href="/assets/js/13.2dc17c00.js"><link rel="prefetch" href="/assets/js/14.ecd84e84.js"><link rel="prefetch" href="/assets/js/15.8e63941b.js"><link rel="prefetch" href="/assets/js/16.20bbf036.js"><link rel="prefetch" href="/assets/js/17.cee65893.js"><link rel="prefetch" href="/assets/js/18.210997b6.js"><link rel="prefetch" href="/assets/js/19.6a9e1c28.js"><link rel="prefetch" href="/assets/js/20.58544cb3.js"><link rel="prefetch" href="/assets/js/21.13c2449f.js"><link rel="prefetch" href="/assets/js/23.ba0e1341.js"><link rel="prefetch" href="/assets/js/24.4d053282.js"><link rel="prefetch" href="/assets/js/25.afea9c0f.js"><link rel="prefetch" href="/assets/js/26.eebee834.js"><link rel="prefetch" href="/assets/js/27.b5e919f8.js"><link rel="prefetch" href="/assets/js/28.eb2b8d47.js"><link rel="prefetch" href="/assets/js/29.39ddf55c.js"><link rel="prefetch" href="/assets/js/3.01798808.js"><link rel="prefetch" href="/assets/js/30.6d0c38c0.js"><link rel="prefetch" href="/assets/js/31.ae50bd7b.js"><link rel="prefetch" href="/assets/js/32.8f993527.js"><link rel="prefetch" href="/assets/js/33.e7076b44.js"><link rel="prefetch" href="/assets/js/34.02650f79.js"><link rel="prefetch" href="/assets/js/35.78660043.js"><link rel="prefetch" href="/assets/js/36.5720a95b.js"><link rel="prefetch" href="/assets/js/37.61ee918b.js"><link rel="prefetch" href="/assets/js/38.dfa679d1.js"><link rel="prefetch" href="/assets/js/39.ed80ae84.js"><link rel="prefetch" href="/assets/js/4.086bf268.js"><link rel="prefetch" href="/assets/js/40.984dfb70.js"><link rel="prefetch" href="/assets/js/41.39b0efef.js"><link rel="prefetch" href="/assets/js/42.348c0630.js"><link rel="prefetch" href="/assets/js/43.af859649.js"><link rel="prefetch" href="/assets/js/44.231224a1.js"><link rel="prefetch" href="/assets/js/45.58ade8a2.js"><link rel="prefetch" href="/assets/js/46.87a325ea.js"><link rel="prefetch" href="/assets/js/47.639c4fd3.js"><link rel="prefetch" href="/assets/js/48.17b33593.js"><link rel="prefetch" href="/assets/js/49.f5dc4f70.js"><link rel="prefetch" href="/assets/js/5.33e71d3e.js"><link rel="prefetch" href="/assets/js/50.e91de543.js"><link rel="prefetch" href="/assets/js/51.8e808c23.js"><link rel="prefetch" href="/assets/js/52.210b18bf.js"><link rel="prefetch" href="/assets/js/53.51bb9c18.js"><link rel="prefetch" href="/assets/js/54.cc3b4480.js"><link rel="prefetch" href="/assets/js/55.d360f572.js"><link rel="prefetch" href="/assets/js/56.2a89706d.js"><link rel="prefetch" href="/assets/js/6.45b5ea40.js"><link rel="prefetch" href="/assets/js/7.227a1975.js"><link rel="prefetch" href="/assets/js/8.9cffc684.js"><link rel="prefetch" href="/assets/js/9.62b6f021.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d9af7a00.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">个人博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">vue</a></div><div class="nav-item"><a href="/" class="nav-link">css</a></div><div class="nav-item"><a href="/" class="nav-link">js</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">github</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/fengjinlong" target="_blank" rel="noopener noreferrer" class="nav-link external">
  1
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fengjinlong" target="_blank" rel="noopener noreferrer" class="nav-link external">
  2
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">vue</a></div><div class="nav-item"><a href="/" class="nav-link">css</a></div><div class="nav-item"><a href="/" class="nav-link">js</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">github</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/fengjinlong" target="_blank" rel="noopener noreferrer" class="nav-link external">
  1
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fengjinlong" target="_blank" rel="noopener noreferrer" class="nav-link external">
  2
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>JavaScript</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/js/defineProperty.html" class="sidebar-link">Object属性系列</a></li><li><a href="/js/Decorator.html" class="sidebar-link">Decorators</a></li><li><a href="/js/Decorator2.html" class="sidebar-link">Decorator 应用</a></li><li><a href="/js/eventBus.html" class="sidebar-link">eventBus</a></li><li><a href="/js/模块.html" class="sidebar-link">模块</a></li><li><a href="/js/bind&amp;new.html" class="active sidebar-link">bind</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js/bind&amp;new.html#bind" class="sidebar-link">bind</a></li><li class="sidebar-sub-header"><a href="/js/bind&amp;new.html#new" class="sidebar-link">new</a></li><li class="sidebar-sub-header"><a href="/js/bind&amp;new.html#手写-bind-方法" class="sidebar-link">手写 bind 方法</a></li><li class="sidebar-sub-header"><a href="/js/bind&amp;new.html#下面高能" class="sidebar-link">下面高能</a></li><li class="sidebar-sub-header"><a href="/js/bind&amp;new.html#让-bind-更好的支持-new-关键字" class="sidebar-link">让 bind 更好的支持 new 关键字</a></li></ul></li><li><a href="/js/es5.html" class="sidebar-link">ES5</a></li><li><a href="/js/es6.html" class="sidebar-link">ES6</a></li><li><a href="/js/语言精髓.html" class="sidebar-link">原型</a></li><li><a href="/js/promise.html" class="sidebar-link">Promise基础</a></li><li><a href="/js/promise思路.html" class="sidebar-link">手写思路</a></li><li><a href="/js/深拷贝.html" class="sidebar-link">深拷贝</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTML</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>http</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>docker</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>性能</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>yarn</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>php</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>node</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>gulp</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>typescript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>webpack</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>mac</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>react</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>interview</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>functional</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>手写代码</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JSON</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>优化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>博文</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="bind"><a href="#bind" aria-hidden="true" class="header-anchor">#</a> bind</h2> <ol><li>调用 call 和 apply 方法会立马执行原函数，而调用 bind 方法会返回一个新的函数，不会立马执行原始函数。bind 的这种特性让原始函数可以延迟执行，方便在事件处理函数中使用。不仅如此，调用 bind 方法返回的函数还具有偏函数，以及对 new 关键字的支持等特性</li></ol> <div class="language- extra-class"><pre class="language-text"><code>const cat = {
  name: 'Tom',
  greeting() {
    const str = 'Hello, my name is ' + this.name
    console.log(str)
  }
}

cat.greeting(); // Hello, my name is Tom

// 将另一个变量指向 cat 的 greeting 方法
const greeting2 = cat.greeting
// this 绑定消失了
greeting2()
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>const cat = {
  name: 'Tom',
  greeting() {
    const str = 'Hello, my name is ' + this.name
    console.log(str)
  }
}

// 将另一个变量指向 cat 的 greeting 方法
const greeting2 = cat.greeting
// 通过 Function.prototype.call 来绑定 this
greeting2.call(cat) // Hello, my name is Tom

// 通过 Function.prototype.apply 来绑定 this
greeting2.apply(cat) // Hello, my name is Tom

// 通过 Function.prototype.bind 来绑定 this
const greeting2AfterBind = greeting2.bind(cat) 
greeting2AfterBind() // Hello, my name is Tom
</code></pre></div><ol start="2"><li>在调用 bind 的时候可以指定参数，当原始函数执行时，这些参数就会被添加到参数列表的最前面。bind 的这个特性使得我们可以很轻易的实现偏函数</li></ol> <div class="language- extra-class"><pre class="language-text"><code>偏函数是函数式编程中的一个概念，使用偏函数，我们可以先缓存一部分参数，在运行时再传入另一部分参数。
function add(x,y) {
  console.log('x + y =',x + y)
  console.log('arguments:',arguments)
}

// 将 5 作为第一个参数传入
const add5 = add.bind(null,5)
add5(5)
</code></pre></div><ol start="3"><li>bind 方法的另一个特性是对 new 关键字的支持。我们已经知道调用 bind 方法会返回一个新的函数，在 JavaScript 中，函数是可以作为类来使用的，如果通过 bind 将一个类中的 this 绑定为另一个对象，然后通过 new 关键字创建一个实例，这个新建实例和绑定的对象之间有什么关系呢？</li></ol> <div class="language- extra-class"><pre class="language-text"><code>function Cat() {
  this.name = 'Tom'
  Cat.prototype.greeting = function () {
    let str = 'Hello, my name is ' + this.name
    console.log(str)
  }
}

const cat1 = new Cat()
cat1.greeting()

// 对 Cat 类中的 this 进行重新绑定
const NewCat = Cat.bind({ name:'Jerry' })
const cat2 = new NewCat() 
cat2.greeting()


运行代码，输出结果如下：



Hello, my name is Tom
Hello, my name is Tom
</code></pre></div><blockquote><ul><li>使用 bind 方法对<strong>类</strong>进行绑定，并不会影响到原始的 this。不过，这<strong>只限于通过 new 关键字</strong>时，将函数作为类来使用的情况，如果通过普通的方式调用函数，则不会存在这样的限制。</li></ul></blockquote> <ol start="4"><li>bind 方法只对第一次绑定生效，后续的绑定都不会起作用</li></ol> <div class="language- extra-class"><pre class="language-text"><code>const cat = {
  name:'Tom',
  greeting() {
    const str = 'Hello, my name is ' + this.name
    console.log(str)
  }
}

const greeting = cat.greeting
// 执行第一次绑定
const greetingFirstBind = greeting.bind(cat)
// 执行第二次绑定
const greetingSecondBind = greetingFirstBind.bind({ name:'Jerry' })
greetingSecondBind() // Hello, my name is Tom
</code></pre></div><h2 id="new"><a href="#new" aria-hidden="true" class="header-anchor">#</a> new</h2> <ol><li>new 的作用</li></ol> <div class="language- extra-class"><pre class="language-text"><code>function Test(name) {
  this.name = name
}
Test.prototype.sayName = function () {
    console.log(this.name)
}
const t = new Test('yck')
console.log(t.name) // 'yck'
t.sayName() // 'yck'
</code></pre></div><blockquote><ul><li>new 通过构造函数 Test 创建出来的实例可以访问到构造函数中的属性</li></ul> <ul><li>new 通过构造函数 Test 创建出来的实例可以访问到构造函数原型链中的属性，也就是说通过 new 操作符，实例与构造函数通过原型链连接了起来</li></ul></blockquote> <ol><li>下面重点来了</li> <li>当下的构造函数 Test 并没有显式 return 任何值（默认返回 undefined），如果我们让它返回值会发生什么事情呢？</li></ol> <div class="language- extra-class"><pre class="language-text"><code>return 原始值
function Test(name) {
  this.name = name
  return 1
}
const t = new Test('yck')
console.log(t.name) // 'yck'

return 引用
function Test(name) {
  this.name = name
  console.log(this) // Test { name: 'yck' }
  return { age: 26 }
}
const t = new Test('yck')
console.log(t) // { age: 26 }
console.log(t.name) // 'undefined'

</code></pre></div><blockquote><ul><li>构造函数如果返回原始值（虽然例子中只有返回了 1，但是你可以试试其他的原始值，结果还是一样的），那么这个返回值毫无意义</li></ul> <ul><li>构造函数如果返回值为对象，那么这个返回值会被正常使用</li></ul> <ul><li>这两个例子告诉了我们一点，构造函数尽量不要返回值。因为返回原始值不会生效，返回对象会导致 new 操作符没有作用。</li></ul></blockquote> <ol start="3"><li>手写new</li></ol> <div class="language- extra-class"><pre class="language-text"><code>function create(Con, ...args) {
  let obj = {}
  Object.setPrototypeOf(obj, Con.prototype)
  let result = Con.apply(obj, args)
  return result instanceof Object ? result : obj
}
</code></pre></div><blockquote><ul><li>首先函数接受不定量的参数，第一个参数为构造函数，接下来的参数被构造函数使用</li></ul> <ul><li>然后内部创建一个空对象 obj</li></ul> <ul><li>因为 obj 对象需要访问到构造函数原型链上的属性，所以我们通过 setPrototypeOf 将两者联系起来。这段代码等同于 obj.<strong>proto</strong> = Con.prototype</li></ul> <ul><li>将 obj 绑定到构造函数上，并且传入剩余的参数</li></ul> <ul><li>判断构造函数返回值是否为对象，如果为对象就使用构造函数返回的值，否则使用 obj，这样就实现了忽略构造函数返回的原始值</li></ul></blockquote> <h2 id="手写-bind-方法"><a href="#手写-bind-方法" aria-hidden="true" class="header-anchor">#</a> 手写 bind 方法</h2> <ol><li>基础</li></ol> <div class="language- extra-class"><pre class="language-text"><code>Function.prototype.bind = function(thisObj) {
  // 判断调用 bind 的方法是不是一个函数
  if(typeof this !== 'function') {
    throw new TypeError('只能对函数使用 bind 方法')
  }

  // 保存当前函数的指针
  const self = this;
  // 拿到除第一个参数以外的其他参数列表
  const args = [].slice.call(arguments,1)

  // 返回一个新的函数
  return function () {
    // 通过 call 函数修改 this 指向
    // 返回原始函数的返回值，这点不要忘了哦
    // 将 bind 函数的剩余参数，放到原始函数参数列表的最前面调用
    return self.apply(thisObj,args.concat([].slice.apply(arguments)))
  }
}
</code></pre></div><blockquote><ul><li>其内部主要使用了 call 和 apply 方法来完成了对 this 的绑定。</li></ul> <ul><li>每次调用 bind 会返回一个新的函数，调用新的函数时，会执行原始函数，并将 bind 方法的剩余参数和新函数的参数列表一并传入原始函数中。</li></ul> <ul><li>这里的 self 是通过闭包保存的原始函数的引用，而 thisObj 也是通过闭包获取的，因此对于一个函数，不管使用 bind 绑定多少次 ，其原始函数在被调用时，总是从第一次调用 bind 方法返回的闭包中去获取新的 this 的值，这也就是多次使用 bind 方法只有第一次有效的原因。</li></ul> <ul><li>由于使用 bind 方法只会让 this 被绑定一次，因此这种方式也叫做硬绑定。</li></ul> <ul><li>不得不说，这真是一种很妙的解决方案，闭包在 JavaScript 中的应用，真是太广泛，太神奇了</li></ul></blockquote> <ol start="2"><li>new 来了老弟</li></ol> <div class="language- extra-class"><pre class="language-text"><code>
function Cat() {
  console.log('this in cat is ',this)
  Cat.prototype.greeting = function() {
    const str = 'Hello, my name is ' + this.name
    console.log(str)
  }
}

const anotherCat = { name:'Jerry'}
const NewCat = Cat.bind(anotherCat)
const newCat = new NewCat()
console.log(newCat)
console.log(newCat.greeting)

运行代码，输出结果如下：

this in cat is  { name: 'Jerry' }
{}
undefined ? what
</code></pre></div><blockquote><p>上面的代码是不是看起来很怪异呢？我们在 Cat 类中打印 this，得到的确实是绑定后的 this，但是最终创建的对象，却是一个空对象，并且这个空对象的 greeting 为 undefined。这是怎么回事呢？</p></blockquote> <blockquote><p>其实，这个问题和 JavaScript 中 new 关键字的机制有关，在 JavaScript 中使用 new 关键字调用函数（创建对象）的流程如下：</p> <blockquote><p>1 申请一块空内存（创建一个空对象）</p></blockquote></blockquote> <blockquote><blockquote><p>2 运行函数，将 this 指向这个新建的对象</p></blockquote></blockquote> <blockquote><blockquote><p>3 执行函数内部的语句，为新对象添加属性和方法</p></blockquote></blockquote> <blockquote><blockquote><p>4 如果函数没有返回值，就返回这个新建的对象，如果函数的返回值为基本数据类型，也会返回这个新建对象</p></blockquote></blockquote> <blockquote><blockquote><p>5 这里的关键点在第四步，如果一个函数没有明确的返回值，使用 new 调用的时候，就会返回新建的对象（也就是 this），如果函数有明确的返回值（这个返回值不能是基本的数据类型，需要是引用类型），使用 new 调用的时候，便不会返回 this，而是函数真实的返回值 。</p></blockquote></blockquote> <h2 id="下面高能"><a href="#下面高能" aria-hidden="true" class="header-anchor">#</a> 下面高能</h2> <blockquote><ul><li>明白了 new 关键字的机制后，我们就可以分析前面通过 new 关键字实例化 NewCat 类，得到的返回值是空对象的原因了。</li> <li>这是因为，NewCat 相对于原始的 Cat 是一个全新的函数（调用 bind 方法方法返回），我们在使用 new 关键字调用 NewCat 时，调用的其实是这个新的函数，在新函数中再通过 call 方法调用 Cat 函数，并没有直接对 Cat 进行实例化。</li> <li>在调用新函数的时候，首先会生成一个空对象。此外，新函数还有一个返回值，返回的是 Cat 函数调用的结果。当 Cat 作为函数而非类调用时，其返回值是 undefined。因而实例化这个新函数的最终结果，就是返回在使用 new 实例化它自身时所创建的那个空对象。</li></ul></blockquote> <div class="language- extra-class"><pre class="language-text"><code>function Cat() {
  console.log('this in cat is ',this)
  this.greeting = function() {
    const str = 'Hello, my name is ' + this.name
    console.log(str)
  }
  // Cat 的 this 被绑定为 {  name:'Jerry' }，这里手动将其返回
  return this
}

const anotherCat = { name:'Jerry'}
const NewCat = Cat.bind(anotherCat)
const newCat = new NewCat()
console.log(newCat)

运行代码，输出结果如下：

this in cat is  { name: 'Jerry' }
{ name: 'Jerry', greeting: [Function] }
</code></pre></div><p><em>Cat 显式的返回了一个引用类型，使用 new 调用 bind 后的新函数时，也会将这个引用类型返回。</em></p> <h2 id="让-bind-更好的支持-new-关键字"><a href="#让-bind-更好的支持-new-关键字" aria-hidden="true" class="header-anchor">#</a> 让 bind 更好的支持 new 关键字</h2> <div class="language- extra-class"><pre class="language-text"><code>Function.prototype.bind = function(thisObj) {
  // 判断调用 bind 的方法是不是一个函数
  if(typeof this !== 'function') {
    throw new TypeError('只能对函数使用 bind 方法')
  }

  // 保存当前函数的指针
  const self = this;
  // 拿到除第一个参数以外的其他参数列表
  const args = [].slice.call(arguments,1)

  function Bound() {
    // 如果 this instanceof Bound，说明是通过 new 关键字调用
    // 这时就将 this 直接绑定到 self，而忽略 thisObj，在 self 内部会对 this 添加属性和方法
    return self.apply(this instanceof Bound ? this : thisObj,args.concat([].slice.apply(arguments)))
  }

  // 实现继承
  if(this.prototype){
    Bound.prototype = Object.create(this.prototype)
  }

  return Bound
}
</code></pre></div><p><em>在执行 Bound 函数时，首先会判断 this 是否是其自身的实例，如果是则说明 Bound 函数正在被 new 关键字调用，那么就将新函数的 this（通过 new 调用新函数时创建的空对象）绑定到 self 上，而忽略 thisObj 对象，运行 self 函数时就会为新函数的 this 添加属性。此外，如果原始函数具有 prototype 属性，还需让 Bound 函数对原始函数进行继承（这里使用的是 ES5 的 Object.create 方法，如果想兼容更低级别的浏览器，可以使用其他继承方式）。</em></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">有志者，事竞成；苦心人，天不负: </span> <span class="time">12/17/2019, 2:25:12 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/js/模块.html" class="prev">
          模块
        </a></span> <span class="next"><a href="/js/es5.html">
          ES5
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.6ba358d5.js" defer></script><script src="/assets/js/2.ae98e73b.js" defer></script><script src="/assets/js/22.b999c181.js" defer></script>
  </body>
</html>
