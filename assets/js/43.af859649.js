(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{172:function(t,e,n){"use strict";n.r(e);var a=n(0),r=Object(a.a)({},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h2",{attrs:{id:"redux中间件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#redux中间件","aria-hidden":"true"}},[t._v("#")]),t._v(" redux中间件")]),t._v(" "),n("blockquote",[n("p",[t._v("dispatch(action)  发送一个action")])]),t._v(" "),n("blockquote",[n("p",[t._v("reducer")]),t._v(" "),n("blockquote",[n("p",[t._v("接受一个action，判断类型并返回新的state")])])]),t._v(" "),n("blockquote",[n("p",[t._v("中间件")])]),t._v(" "),n("blockquote",[n("blockquote",[n("p",[t._v("接收 store，用来获取getState。返回一个fun(dispatch)的函数。fun 返回一个函数fun2(action), fun2执行dispatch(action)即next(action)并添加logger逻辑。实际调用store.dispatch(action)就是fun2(action)。即 fun2 就是next就是store.dispatch")])])]),t._v(" "),n("blockquote",[n("p",[t._v("createStore")]),t._v(" "),n("blockquote",[n("p",[t._v("createStore (reducer, initialState, middlewareFun)")])])]),t._v(" "),n("ol",[n("li",[t._v("当不存在中间件时候返回store对象以及相关操作。 不存在applyMiddleware")]),t._v(" "),n("li",[t._v("当存在中间件时候，走applyMiddleware逻辑\nmiddlewareFun(createStore)(reducer, initialState)")])]),t._v(" "),n("blockquote",[n("p",[t._v("applyMiddleware")]),t._v(" "),n("blockquote",[n("p",[t._v("接收中间件，返回一个创建store的函数")])])]),t._v(" "),n("ol",[n("li",[t._v("由于调用方式为 const store = createStore(reducer, applyMiddleware(logger))")]),t._v(" "),n("li",[t._v("所以middlewareFun相当于 applyMiddleware 已经执行一次后的返回值（返回一个创建store的函数） 此时实参就是 没有中间件的createStore方法")]),t._v(" "),n("li",[t._v("引用createStore原始方法的同时，添加新逻辑（createStore添加新的返回值，返回一个方法）")]),t._v(" "),n("li",[t._v("此时的createStore 返回一个接收 reducer和initialState 参数的函数")]),t._v(" "),n("li",[t._v("遍历中间件，并把中间件返回的dispatch赋值给当前store的dispath")]),t._v(" "),n("li",[t._v("添加中间件的store.dispatch方法自然就带上了中间件的逻辑")])]),t._v(" "),n("h3",{attrs:{id:"t-js"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#t-js","aria-hidden":"true"}},[t._v("#")]),t._v(" t.js")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("import  {createStore, reducer,applyMiddleware, compose}  from './tt.js'\nimport {logger} from './middlewares'\n\nconst store = createStore(reducer, applyMiddleware(logger))\n\nstore.subscribe(() => {\n  console.log('change')\n  console.log(store.getState())\n})\nstore.dispatch({type: 'info',pal: {v:1111}})\n")])])]),n("h3",{attrs:{id:"tt-js"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#tt-js","aria-hidden":"true"}},[t._v("#")]),t._v(" tt.js")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("export function createStore (reducer, initialState, middleFunc) {\n  if (initialState && typeof initialState === 'function') {\n    middleFunc = initialState\n    initialState = undefined\n  }\n  let currentState = initialState\n  let listeners = []\n\n  if (middleFunc && typeof middleFunc === 'function') {\n    return middleFunc(createStore)(reducer, initialState)\n  }\n  const getState = () => {\n    return currentState\n  }\n  const dispatch = (action) => {\n    currentState = reducer(currentState, action)\n    listeners.forEach(listener => {\n      listener()\n    })\n  }\n  const subscribe = (listener) => {\n    listeners.push(listener)\n  }\n\n  return {\n    getState,\n    dispatch,\n    subscribe\n  }\n}\n\nconst initState = {\n  info: 'info'\n}\nexport function reducer (state=initState, action) {\n  switch (action.type) {\n    case 'info':\n      return {\n        ...state,\n        info: action.pal.v\n      }\n    default:\n      return {\n        ...state\n      }\n  }\n}\n\n\nexport function applyMiddleware (...middlewares) {\n  return createStore => (reducer, ...args) => {\n    const store = createStore(reducer, ...args)\n    const chains = middlewares.map(middle => middle(store))\n    let dispatch = store.dispatch\n    chains.forEach(fun => {\n      dispatch = fun(dispatch)\n    })\n\n\n    return {\n      ...store,\n      dispatch\n    }\n  }\n\n}\n")])])]),n("h3",{attrs:{id:"middlewares-js"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#middlewares-js","aria-hidden":"true"}},[t._v("#")]),t._v(" middlewares.js")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("export const logger = store => next => action => {\n  console.log('dispatching', action)\n  next(action)\n  console.log('next state', store.getState())\n}\n")])])])])},[],!1,null,null,null);e.default=r.exports}}]);